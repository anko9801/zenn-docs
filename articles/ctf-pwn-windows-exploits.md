---
title: "【CTF 探訪記】Windows Exploits"
emoji: "😸"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["CTF", "pwn"]
published: false
---

Windows は大量のセキュリティ機構があります。

exploit も限られていますが

## 緩和策
### Address Space Layout Randomization
Address Space Layout Randomization (ASLR)
プロセスが使用する仮想メモリの中の様々な領域のアドレスをランダム化する

- bottomup ASLR
  - VirtualAlloc
- High Entropy ASLR
- ASLR Disallow Stripped Images

### Data Execution Prevention
Data Execution Prevention (DEP)
スタックやヒープ領域の機械語命令の実行を不可能にする技術

- Arbitary Code Guard
  - 実行属性がついたページを作成することを不可能にする緩和策

### Structured Exception Handling
Structured Exception Handling (SEH)

safe SEH
SEHOP

### Control Flow Guard
Return Flow Guard
Stack Pivot
Caller Check
SimExec

### image load
No Remote Images
No Low IL Images

Disable Extension Points

### a
Export Address Filter
Import Address Filter
Disable Child Process Creation

緩和策名 説明 設定方法
- Disable-Non-System-Fonts
  - ${SYSTEMROOT}\Fonts ディレクトリにインストールされた後にユーザのログオン時に Winlogon によって未登録の任意のファイルが読み込まれるのを防ぐという、信頼されていないフォントをブロックする機能*1。SetProcessMitigationPolicy 関数、Set-ProcessMitigation コマンド、Exploit Protection から設定可能。
- Prefer-System32-Images
  - DLL の探索順序を利用して悪意のある DLL をプロセスに読み込ませることを防止するため、ローダーの検索パスを変更し特定の DLL の読み込みを常に${SYSTEM_ROOT}\System32 フォルダ内で検索する機能*2。SetProcessMitigationPolicy 関 数 、Set-ProcessMitigation コマンドから
設定可能。
- Heap-Terminate-On-Corruption
  - ヒープが破損した場合にプロセスを強制終了することによって、ヒープ破損の例外ハンドラを悪用する攻撃や時々ヒープの破損を起こす程度の Exploit を防御するという、ヒープの整合性を検証する機能*3。HeapSetInformation 関 数 、Set-ProcessMitigation コ マ ン ド 、Exploit Protection から設定可能。
- Filter-Win32k-System-Calls
  - Set-ProcessMitigation コマンド、Exploit Protection から設定可能。
- Raise-Exception-on-Invalid-Handle
  - SetProcessMitigationPolicy 関 数 、Set-ProcessMitigation コマンド、Exploit Protection から設定可能。

## 回避
### SEH overwrite
