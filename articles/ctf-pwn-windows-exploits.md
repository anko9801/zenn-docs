---
title: "ã€CTF æ¢è¨ªè¨˜ã€‘Windows Exploits"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "pwn"]
published: false
---

Windows ã¯å¤§é‡ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿæ§‹ãŒã‚ã‚Šã¾ã™ã€‚

exploit ã‚‚é™ã‚‰ã‚Œã¦ã„ã¾ã™ãŒ

## ç·©å’Œç­–
### Address Space Layout Randomization
Address Space Layout Randomization (ASLR)
ãƒ—ãƒ­ã‚»ã‚¹ãŒä½¿ç”¨ã™ã‚‹ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ä¸­ã®æ§˜ã€…ãªé ˜åŸŸã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã™ã‚‹

- bottomup ASLR
  - VirtualAlloc
- High Entropy ASLR
- ASLR Disallow Stripped Images

### Data Execution Prevention
Data Execution Prevention (DEP)
ã‚¹ã‚¿ãƒƒã‚¯ã‚„ãƒ’ãƒ¼ãƒ—é ˜åŸŸã®æ©Ÿæ¢°èªå‘½ä»¤ã®å®Ÿè¡Œã‚’ä¸å¯èƒ½ã«ã™ã‚‹æŠ€è¡“

- Arbitary Code Guard
  - å®Ÿè¡Œå±æ€§ãŒã¤ã„ãŸãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ä¸å¯èƒ½ã«ã™ã‚‹ç·©å’Œç­–

### Structured Exception Handling
Structured Exception Handling (SEH)

safe SEH
SEHOP

### Control Flow Guard
Return Flow Guard
Stack Pivot
Caller Check
SimExec

### image load
No Remote Images
No Low IL Images

Disable Extension Points

### a
Export Address Filter
Import Address Filter
Disable Child Process Creation

ç·©å’Œç­–å èª¬æ˜ è¨­å®šæ–¹æ³•
- Disable-Non-System-Fonts
  - ${SYSTEMROOT}\Fonts ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå¾Œã«ãƒ¦ãƒ¼ã‚¶ã®ãƒ­ã‚°ã‚ªãƒ³æ™‚ã« Winlogon ã«ã‚ˆã£ã¦æœªç™»éŒ²ã®ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã‚’é˜²ãã¨ã„ã†ã€ä¿¡é ¼ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚©ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹æ©Ÿèƒ½*1ã€‚SetProcessMitigationPolicy é–¢æ•°ã€Set-ProcessMitigation ã‚³ãƒãƒ³ãƒ‰ã€Exploit Protection ã‹ã‚‰è¨­å®šå¯èƒ½ã€‚
- Prefer-System32-Images
  - DLL ã®æ¢ç´¢é †åºã‚’åˆ©ç”¨ã—ã¦æ‚ªæ„ã®ã‚ã‚‹ DLL ã‚’ãƒ—ãƒ­ã‚»ã‚¹ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã“ã¨ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ€ãƒ¼ã®æ¤œç´¢ãƒ‘ã‚¹ã‚’å¤‰æ›´ã—ç‰¹å®šã® DLL ã®èª­ã¿è¾¼ã¿ã‚’å¸¸ã«${SYSTEM_ROOT}\System32 ãƒ•ã‚©ãƒ«ãƒ€å†…ã§æ¤œç´¢ã™ã‚‹æ©Ÿèƒ½*2ã€‚SetProcessMitigationPolicy é–¢ æ•° ã€Set-ProcessMitigation ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰
è¨­å®šå¯èƒ½ã€‚
- Heap-Terminate-On-Corruption
  - ãƒ’ãƒ¼ãƒ—ãŒç ´æã—ãŸå ´åˆã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·åˆ¶çµ‚äº†ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ãƒ’ãƒ¼ãƒ—ç ´æã®ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ã‚’æ‚ªç”¨ã™ã‚‹æ”»æ’ƒã‚„æ™‚ã€…ãƒ’ãƒ¼ãƒ—ã®ç ´æã‚’èµ·ã“ã™ç¨‹åº¦ã® Exploit ã‚’é˜²å¾¡ã™ã‚‹ã¨ã„ã†ã€ãƒ’ãƒ¼ãƒ—ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹æ©Ÿèƒ½*3ã€‚HeapSetInformation é–¢ æ•° ã€Set-ProcessMitigation ã‚³ ãƒ ãƒ³ ãƒ‰ ã€Exploit Protection ã‹ã‚‰è¨­å®šå¯èƒ½ã€‚
- Filter-Win32k-System-Calls
  - Set-ProcessMitigation ã‚³ãƒãƒ³ãƒ‰ã€Exploit Protection ã‹ã‚‰è¨­å®šå¯èƒ½ã€‚
- Raise-Exception-on-Invalid-Handle
  - SetProcessMitigationPolicy é–¢ æ•° ã€Set-ProcessMitigation ã‚³ãƒãƒ³ãƒ‰ã€Exploit Protection ã‹ã‚‰è¨­å®šå¯èƒ½ã€‚

## å›é¿
### SEH overwrite
