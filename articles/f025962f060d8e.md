---
title: "ã€CTF æ¢è¨ªè¨˜ã€‘æ ¼å­æš—å·ã¸ã®æ”»æ’ƒ"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "crypto"]
published: true
---

## æ ¼å­ã¨ã¯
æ ¼å­ã¨ã„ã†ã®ã¯åŸºåº•ã‚’è¶³ã—å¼•ãã™ã‚‹ã“ã¨ã§ç¾ã‚Œã‚‹ç©ºé–“ä¸Šã«ç­‰é–“éš”ã§ä¸¦ã¶ç‚¹ã®é›†åˆã§ã™ã€‚

![](/images/lattice.png)

å›³ã§ã¯ç‚¹ã‚’ã™ã¹ã¦é›†ã‚ãŸã‚‚ã®ã‚’æ ¼å­ã€åŒã˜è‰²ã®çŸ¢å°ãŒåŸºåº•ã§ã™ã€‚

ä¾‹ãˆã°ç·‘è‰²ã®åŸºåº•ã«æ³¨ç›®ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã“ã‚Œã‚’ 2 å€ã€3 å€ ... ã¾ãŸè² ã®æ–¹å‘ã«ã‚‚ -1 å€ã€-2 å€ã¨é€²ã‚ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](/images/lattice2.png)

ã“ã®åå­—ã¯åŸºåº•ã®ä¸€æ–¹ã‚’è¶³ã—å¼•ãã™ã‚‹ã“ã¨ã§ä½œã‚‰ã‚Œã¾ã—ãŸã€‚ãã—ã¦ã“ã®ç¸¦ã¨æ¨ªã®çŸ¢å°ã‚’è¶³ã—åˆã‚ã›ã‚‹ã“ã¨ã§ã™ã¹ã¦ã®ç‚¹ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

è©¦ã—ã¦ã¿ã‚‹ã¨ã“ã‚Œã¯èµ¤ã„åŸºåº•ã§ã¯åŒã˜æ ¼å­ãŒä½œã‚‰ã‚Œã¾ã™ãŒã€é’ã„åŸºåº•ã§ã¯ 1 ã¤é£›ã°ã—ã®æ ¼å­ãŒä½œã‚‰ã‚Œã¾ã™ã€‚

ãªãœã§ã—ã‚‡ã†ã‹ã€‚

ã“ã‚Œã¯åŸºåº•ã‚’å¤‰æ›ã™ã‚‹ã“ã¨ã§ã‚ã‹ã‚Šã¾ã™ã€‚ã“ã®ã¨ãã®ãƒ«ãƒ¼ãƒ«ã¯æ¯å›ç‰‡æ–¹ã ã‘ã—ã‹å¤‰æ›´ã—ãªã„ã“ã¨ã§ã™ã€‚

ãã‚Œã§ã¯é’è‰²ã®åŸºåº•ã‚’å¤‰æ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšåŸºåº• 1 ã«åŸºåº• 2 ã‚’è¶³ã™ã¨çŸ¢å° 3 ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’æ–°ãŸãªåŸºåº• 1 ã¨ã—ã¾ã™ã€‚
æ¬¡ã«åŸºåº• 2 ã‚’ -1 å€ã™ã‚‹ã¨çŸ¢å° 4 ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’æ–°ãŸãªåŸºåº• 2 ã¨ã—ã¾ã™ã€‚

![](/images/lattice3.png)

ã“ã‚Œã§ä½œã‚‰ã‚ŒãŸæ–°ã—ã„åŸºåº•ã¨ã•ã£ãã®ç·‘è‰²ã®åŸºåº•ã¨ã‚’æ¯”ã¹ã¦ã¿ã¦ãã ã•ã„ã€‚ä¸€æ–¹ã®åŸºåº•ãŒ 2 å€ã®é•·ã•ã«ãªã£ã¦ã„ã‚‹ã®ã§ 1 ã¤é£›ã°ã—ã®æ ¼å­ã«ãªã‚Šã¾ã™ã€‚

èµ¤ã„åŸºåº•ã®æ–¹ã‚‚å¤‰æ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1 ã‹ã‚‰ 2 ã‚’å¼•ã„ã¦ 3 ã«ãªã‚Šã¾ã™ã€‚
2 ã‹ã‚‰ 3 ã® 4 å€ã‚’å¼•ã„ã¦ 4 ã«ãªã‚Šã¾ã™ã€‚
3 ã« 4 ã‚’è¶³ã—ã¦ 5 ã«ãªã‚Šã¾ã™ã€‚

ã™ã‚‹ã¨ç·‘è‰²ã®åŸºåº•ã¨åŒã˜æ ¼å­ã‚’è²¼ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![](/images/lattice4.png)

ã“ã®ã‚ˆã†ã«åˆ†ã‹ã‚Šã«ãã‹ã£ãŸåŸºåº•ã‚’åˆ†ã‹ã‚Šã‚„ã™ã„åŸºåº•ã«å¤‰æ›ã™ã‚‹æ“ä½œã®ã“ã¨ã‚’åŸºåº•ç°¡ç´„ã¨è¨€ã„ã¾ã™ã€‚

åŸºåº•ç°¡ç´„ã™ã‚‹ã“ã¨ã§ã‚ã‚‹ç‚¹ã‹ã‚‰æœ€ã‚‚è¿‘ã„è·é›¢ã®ç‚¹ã‚’è¦‹ã¤ã‘å‡ºã™ã“ã¨ãŒå‡ºæ¥ãã†ã§ã™ã€‚

ã¨ã“ã“ã¾ã§çŸ¢å°éŠã³ã‚’ã—ã¦ãã¾ã—ãŸãŒæœ¬è³ªã¯ã‚‚ã†èªã‚Šå°½ãã—ã¾ã—ãŸã€‚ã“ã‚ŒãŒæ ¼å­ã®å…¨ã¦ã§ã™ã€‚

### æ ¼å­ã®å•é¡Œ

ã“ã‚Œã‚’æ•°å­¦çš„ã«è¡¨ç¾ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚
> **Def. æ ¼å­**
>  $n$ å€‹ã®ç·šå½¢ç‹¬ç«‹ãªãƒ™ã‚¯ãƒˆãƒ« $\bm{b}_1,\ldots,\bm{b}_n\in\mathbb{R}^m$ ã«ã¤ã„ã¦æ•´æ•°ä¿‚æ•°ã®ç·šå½¢çµåˆã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ãƒ™ã‚¯ãƒˆãƒ«ã®é›†åˆã‚’æ ¼å­ $\mathcal{L}$ ã¨å®šç¾©ã—ã¾ã™ã€‚
>
> $$
\mathcal{L}(\bm{b}_1,\ldots, \bm{b}_n) := \left\lbrace\sum_{i=1}^{n} a_i\bm{b}_i\in\mathbb{R}^m\ \middle|\ a_i \in \mathbb{Z} \right\rbrace
$$

å…ˆç¨‹ã®æ ¼å­ã®åŸºåº•ã®å¤‰æ›ã‚’åŸºæœ¬å¤‰å½¢ã¨è¨€ã„ã¾ã™ã€‚

> **Prop.**
> æ ¼å­åŸºåº•ã®åŸºæœ¬å¤‰å½¢ã«å¯¾ã—ã€æ ¼å­ã¯ä¸å¤‰ã§ã‚ã‚‹ã€‚

ã“ã“ã§åŸç‚¹ã‹ã‚‰æœ€çŸ­ã®ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¦‹ã¤ã‘ã‚‹å•é¡Œã‚’è€ƒãˆã¾ã™ã€‚

> **SVP; Shortest Vector Problem**
> æ ¼å­ä¸Šã®éé›¶ãªãƒ™ã‚¯ãƒˆãƒ«ã®ä¸­ã§æœ€ã‚‚ãƒãƒ«ãƒ ãŒå°ã•ãªãƒ™ã‚¯ãƒˆãƒ«ã‚’è¦‹ã¤ã‘å‡ºã™å•é¡Œã‚’ SVP ã¨ã„ã†ã€‚ãã®ãƒ™ã‚¯ãƒˆãƒ«ã‚’ $\bm{v}$ ã¨ãŠãã¨æ¬¡ã®ã‚ˆã†ã«è¡¨ã›ã‚‰ã‚Œã‚‹ã€‚
>
> $$
\bm{v} = v_1\bm{b}_1 + \cdots + v_n\bm{b}_n \qquad (v_1, \ldots , v_n \in \mathbb{Z}) \\
$$

ç´ æœ´ã«è€ƒãˆã‚‹ã¨æœ€çŸ­ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ç‚ºã«ã¯è‰²ã‚“ãªä¿‚æ•°ã‚’è©¦ã—ã¦æ¢ç´¢ã™ã‚Œã°è‰¯ã•ãã†ã§ã™ã€‚ã—ã‹ã—ã“ã®æ–¹æ³•ã ã¨ãƒ™ã‚¯ãƒˆãƒ«ã®æ•°ã«å¯¾ã—ã¦æŒ‡æ•°çš„ã«æ¢ç´¢ç©ºé–“ãŒåºƒãŒã‚‹ã®ã§è¨ˆç®—æ™‚é–“ã‚‚æŒ‡æ•°æ™‚é–“æ›ã‹ã‚Šã¾ã™ã€‚ãã—ã¦ã“ã®å•é¡Œã¯ NP å›°é›£ã¨çŸ¥ã‚‰ã‚Œã¦ã„ã¦ã€ã“ã‚Œã‚’ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¬ãƒ™ãƒ«ã§æ”¹å–„ã™ã‚‹æ–¹æ³•ã¯ä»Šã®ã¨ã“ã‚è¦‹ã¤ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚

ã“ã® SVP ãŒæš—å·ã§ä½¿ã‚ã‚Œã‚‹å…¨ã¦ã®æ ¼å­å•é¡Œã®åŸºç¤ã¨ãªã‚Šã¾ã™ã€‚

ãŸã æ¢ç´¢ã™ã‚‹é †ç•ªã‚’åŠ¹ç‡åŒ–ã—ãŸã‚Šã€æœ€çŸ­ã§ã¯ãªã„ãŒæœ€çŸ­ã«è¿‘ã„ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¦‹ã¤ã‘ã‚‹å•é¡Œ (Î¼SVP) ã‚’è§£ãã“ã¨ã¯ã§ãã¾ã™ã€‚ãã‚Œã‚’æ‹…ã†ã®ãŒåŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚ä¸€å¿œæ–­ã£ã¦ãŠãã¾ã™ãŒåŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã¯ SVP ã¯è§£ã‘ã¾ã›ã‚“ (è§£ã‘ãŸã‚‰ NP å›°é›£ã§ã¯ãªã„)ã€‚

## åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

å…ˆç¨‹ã®ã‚ˆã†ã«åŸºåº•ç°¡ç´„ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã©ã®ã‚ˆã†ã«çµ„ã‚ã°è‰¯ã„ã®ã§ã—ã‚‡ã†ã‹ã€‚

ã¾ãšåŸºåº•ç°¡ç´„ã§ç›®æŒ‡ã™åŸºåº•ã‚’æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚

- ãã‚Œãã‚Œã®åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ãŒç›´äº¤ã«è¿‘ã„çŠ¶æ…‹
- åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ãŒçŸ­ã„

ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

```mermaid
flowchart LR
    id0(åŸºåº•ã®ç›´äº¤åŒ–) --> id2(ã‚µã‚¤ã‚ºåŸºåº•ç°¡ç´„) --> id3(LLL åŸºåº•ç°¡ç´„) --> id4(HKZ åŸºåº•ç°¡ç´„) --> id5(BKZ åŸºåº•ç°¡ç´„) --> id6(BKZ2.0)
    id1(Lagrange åŸºåº•ç°¡ç´„) --> id2
    id5 --> id7(RSR)
    id5 --> id8(G6K)
```

ä»Šå›ã¯ LLL åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¾ã§ã‚’æ‰±ã„ã¾ã™ã€‚ãã‚Œä»¥é™ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ç´¹ä»‹ã—ã¾ã›ã‚“ãŒã€SageMath ã§ä½¿ã„ã¯ã™ã‚‹ã®ã§ç†è§£ã—ãŸã‘ã‚Œã°å‚è€ƒæ–‡çŒ®ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

### 1 æ¬¡å…ƒã®æ ¼å­ (ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•)

2 ã¤ã®æ•´æ•°ã‚’è¶³ã—å¼•ãã—ã¦æœ€å°ã¨ãªã‚‹å€¤ã‚’æ±‚ã‚ã‚‹ã€‚ã“ã‚Œã¯æœ€å¤§å…¬ç´„æ•°ã‚’è¨ˆç®—ã™ã‚‹ã®ã¨åŒã˜ã§ä¸­å­¦æ ¡ã§ã‚„ã£ãŸã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’ä½¿ã†ã“ã¨ã§æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

ä¾‹ãˆã° 390 ã¨ 273 ã«ã¤ã„ã¦ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’è€ƒãˆã‚‹ã¨

$$
\begin{aligned}
  390 & = 273 \times 1 + 117 \\
  273 & = 117 \times 2 + 39 \\
  117 & = 39 \times 3
\end{aligned}
$$

ã¨ã„ã†ã“ã¨ã‹ã‚‰ä¸¦ã¹ã‚‹ã¨ 39 ãšã¤é£›ã‚“ã ç‚¹åˆ—ã¨ãªã‚Šã¾ã™ã€‚

### 2 æ¬¡å…ƒã®æ ¼å­ (Lagrange åŸºåº•ç°¡ç´„)

ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’ 2 æ¬¡å…ƒæ ¼å­ã«å¯¾ã—ã¦è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> **Lagrange åŸºåº•ç°¡ç´„ (Gaussian Reduction)**
> $\|\bm{v}_1\| < \|\bm{v}_2\|$ ã¨ãªã‚‹ã‚ˆã†ã«äº¤æ›ã—ã¦
>
> $$
  \bm{v}_2 \to \bm{v}_2 - \left\lfloor\frac{\bm{v}_1\cdot \bm{v}_2}{\|\bm{v}_1\|^2}\right\rceil\bm{v}_1
$$
>
> ã‚’ç¹°ã‚Šè¿”ã— $m = 0$ ã¨ãªã‚‹ã¨ã $\bm{v}_1$, $\bm{v}_2$ ã¯æœ€ã‚‚ç°¡ç´„ã•ã‚ŒãŸåŸºåº•ã¨ãªã‚‹ã€‚

> **Theorem**
> Lagrange ç°¡ç´„ã•ã‚ŒãŸåŸºåº•ã¯æœ€ã‚‚çŸ­ã„åŸºåº•ã§ã‚ã‚‹ã€‚

**Proof.**
ä»»æ„ã®éé›¶ãƒ™ã‚¯ãƒˆãƒ« $\mathbf{v} = x _ 1\mathbf{b} _ 1 + x _ 2\mathbf{b} _ 2 \in L$ ã«ã¤ã„ã¦ $x _ 2 = 0$ ã®ã¨ã $\|\mathbf{v}\| = |x _ 1|\|\mathbf{b} _ 1\| \geq \|\mathbf{b} _ 1\|$, $x _ 2 \neq 0$ ã®ã¨ã $\|\mathbf{v}\| \geq \|\mathbf{b} _ 2\| \geq \|\mathbf{b} _ 1\|$ ã‚’ç¤ºã™.

$$
\begin{aligned}
\|\mathbf{v}\| &= \|x _ 1\mathbf{b} _ 1 + x _ 2\mathbf{b} _ 2\| \\
&= \|r\mathbf{b} _ 1 + x _ 2(\mathbf{b} _ 2 + q\mathbf{b} _ 1)\| \\
&\geq x _ 2\|\mathbf{b} _ 2 + q\mathbf{b} _ 1\| - r\|\mathbf{b} _ 1\| \\
&= (x _ 2 - r)\|\mathbf{b} _ 2 + q\mathbf{b} _ 1\| + r(\|\mathbf{b} _ 2 + q\mathbf{b} _ 1\| - \|\mathbf{b} _ 1\|) \\
&\geq \|\mathbf{b} _ 2 + q\mathbf{b} _ 1\| \\
&\geq \|\mathbf{b} _ 2\| \geq \|\mathbf{b} _ 1\|
\end{aligned}
$$

ã“ã‚Œã‚ˆã‚Š 2 æ¬¡å…ƒã®æ ¼å­ã‚‚åŸºåº•ç°¡ç´„ãŒå®Œäº†ã—ã¾ã™ã€‚ã—ã‹ã— 3 æ¬¡å…ƒä»¥ä¸Šã®æ ¼å­ã§ã¯åŒæ§˜ã®æ–¹æ³•ã§ç°¡ç´„ã—ã¦ã‚‚æœ€ã‚‚çŸ­ã„åŸºåº•ã¨ã¯ãªã‚‰ãšã« NP å›°é›£ãªå•é¡Œã¨ãªã‚Šã¾ã™ã€‚ã“ã®å•é¡Œã«ç«‹ã¡å‘ã‹ã†ç‚ºã«ã¯ã¾ãšåŸºåº•ã®ç›´äº¤æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒå¿…è¦ã§ã™ã€‚

```python
def gaussian_reduction(v1, v2):
    while True:
        if v2.norm() < v1.norm():
            v1, v2 = v2, v1
        m = floor(v1.dot_product(v2) / v1.dot_product(v1))
        if m == 0:
            break
        v2 = v2 - m*v1
    return v1, v2


v1 = vector([846835985, 9834798552])
v2 = vector([87502093, 123094980])
```

### ã‚°ãƒ©ãƒ ãƒ»ã‚·ãƒ¥ãƒŸãƒƒãƒˆç›´äº¤åŒ–

ã‚°ãƒ©ãƒ ãƒ»ã‚·ãƒ¥ãƒŸãƒƒãƒˆç›´äº¤åŒ– (GSO; Gram-Schmidt Orthonormalization) ã¨ã¯ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ç©ºé–“ã§åŸºåº•ã‚’ç›´äº¤åŸºåº•ã«å¤‰æ›ã™ã‚‹æ–¹æ³•ã§ã™ã€‚å›³å½¢çš„ã«ã¯ $\bm{b}_n$ ã®ç›´äº¤åŒ–ã¯ $\bm{b}_{1}$ ã‹ã‚‰ $\bm{b}_{n-1}$ ã¾ã§ã®ãƒ™ã‚¯ãƒˆãƒ«ã™ã¹ã¦ã¨ç›´äº¤ã™ã‚‹ã‚ˆã†ã«å…ƒã®é«˜ã•ã®ã¾ã¾ç§»å‹•ã•ã›ã¾ã™ã€‚ GSO ã® Wikipedia ã® gif ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

$$
\bm{B} = \begin{pmatrix}
  \bm{b}_1 \\
  \vdots \\
  \bm{b}_n \\
\end{pmatrix} = \begin{pmatrix}
  b_{11} & \cdots & b_{1m} \\
  \vdots & \ddots & \vdots \\
  b_{n1} & \cdots & b_{nm} \\
\end{pmatrix}
$$

> **Def. GSO ãƒ™ã‚¯ãƒˆãƒ«**
> $n$ æ¬¡å…ƒæ ¼å­ $L\subseteq \mathbb{R}^m$ ã®é †åºä»˜ãåŸºåº• $\{\bm{b}_{1},\ldots, \bm{b}_{n}\}$ ã«å¯¾ã™ã‚‹ GSO ãƒ™ã‚¯ãƒˆãƒ« $\bm{b}_{1}^* ,\ldots, \bm{b}_{n}^ *\in\mathbb{R}^m$ ã‚’ GSO ä¿‚æ•° $\mu_{i,j}$ ã‚’ç”¨ã„ã¦æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã™ã‚‹ã€‚
>
> $$
\begin{aligned}
&\begin{dcases}
\bm{b}_1^* := \bm{b}_1 \\
\bm{b}_i^* := \bm{b}_i - \sum_{j=1}^{i-1} \mu_{ij} \bm{b}_j^* & (2\leq i\leq n) \\
\end{dcases} \\
&\quad \mu_{ij} := \frac{\langle \bm{b}_i, \bm{b}_j^* \rangle}{\| \bm{b}_j^*\|^2} \qquad (1\leq j<i\leq n)
\end{aligned}
$$

è¡Œåˆ—ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚

$$
\begin{aligned}
\begin{pmatrix}
\bm{b}_1 \\
\vdots \\
\bm{b}_n \\
\end{pmatrix}
& =
\begin{pmatrix}
1 & 0 & 0 & & 0 \\
\mu_{21} & 1 & 0 & \cdots & 0 \\
\mu_{31} & \mu_{32} & 1 & & 0 \\
& \vdots & & \ddots & \vdots \\
\mu_{n1} & \mu_{n2} & \mu_{n3} & \cdots & 1 \\
\end{pmatrix}
\begin{pmatrix}
\bm{b}_1^ * \\
\vdots \\
\bm{b}_n^ * \\
\end{pmatrix} \\
\\
\bm{B} & = \bm{U}\bm{B}^*
\end{aligned}
$$

ã“ã® $\bm{B}$ã€$\bm{B}^*$ã€$\bm{U}$ ã‚’ãã‚Œãã‚Œ **åŸºåº•è¡Œåˆ—**ã€**GSO ãƒ™ã‚¯ãƒˆãƒ«è¡Œåˆ—**ã€**GSO ä¿‚æ•°è¡Œåˆ—** ã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã™ã€‚

> **Prop. GSO ãƒ™ã‚¯ãƒˆãƒ«ã®åŸºæœ¬æ€§è³ª**
> 1. ä»»æ„ã® $1\leq i<j\leq n$ ã«å¯¾ã—ã¦ $\langle\bm{b}_i^*, \bm{b}_j^*\rangle = 0$ ãŒæˆã‚Šç«‹ã¤ã€‚
> 2. ä»»æ„ã® $1\leq i\leq n$ ã«å¯¾ã—ã¦ $\|\bm{b}_i^*\|\leq\|\bm{b}_i\|$ ãŒæˆã‚Šç«‹ã¤ã€‚
> 3. ä»»æ„ã® $1\leq i\leq n$ ã«å¯¾ã—ã¦ $\langle\bm{b}_1^* ,\ldots,\bm{b}_i^*\rangle_{\mathbb{R}} = \langle\bm{b}_1,\ldots,\bm{b}_i\rangle_{\mathbb{R}}$ ãŒæˆã‚Šç«‹ã¤ã€‚
> 4. $\mathrm{vol}(L) = \prod_{i=1}^n\|\bm{b}_i^*\|$ ãŒæˆã‚Šç«‹ã¤ã€‚

**Proof.**
ã¾ãš 1 ã«ã¤ã„ã¦ $j = 1$ ã®ã¨ãè¨¼æ˜ã›ãšã¨ã‚‚æˆã‚Šç«‹ã¤ã€‚$1\leq j\leq k$ ã®ã¨ã $\langle\bm{b}_i^*, \bm{b}_j^*\rangle = 0$ ãŒæˆã‚Šç«‹ã¤ã¨ä»®å®šã—ã¦ã€$j = k+1$ ã®ã¨ã

$$
\begin{aligned}
  \langle\bm{b}_i^*,\bm{b}_{k+1}^*\rangle &
  = \left\langle\bm{b}_i^*,\bm{b}_{k+1} - \sum_{n=1}^k\mu_{k+1 n}\bm{b}_{n}^*\right\rangle \\
  & = \langle\bm{b}_i^*,\bm{b}_{k+1}\rangle-\mu_{
  k+1 i}\|\bm{b}_i^*\|^2\\
  & = 0
\end{aligned}
$$

ãŒæˆã‚Šç«‹ã¤ã€‚ã‚ˆã£ã¦æ•°å­¦çš„å¸°ç´æ³•ã‚ˆã‚Šæˆã‚Šç«‹ã¤ã€‚
2 ã«é–¢ã—ã¦ã¯å®šç¾©å¼ã«ãƒãƒ«ãƒ ã‚’å–ã‚‹ã“ã¨ã§åˆ†ã‹ã‚‹ã€‚

$$
\begin{aligned}
  \|\bm{b} _ 1^*\|^2 & = \|\bm{b}_1\|^2 \\
  \|\bm{b}_ i\|^2 & = \|\bm{b} _ i^ * \|^2 + \sum_{j=1}^{i-1}\mu _ {i,j}^2\|\bm{b}_j^ * \|^2\geq\|\bm{b} _ i^ * \|^2
\end{aligned}
$$

3 ã«ã¤ã„ã¦ã¯ã¾ãš $\langle\bm{b}_1,\ldots,\bm{b}_i\rangle_{\mathbb{R}}\subseteq\langle\bm{b}_1^*,\ldots,\bm{b}_i^*\rangle_{\mathbb{R}}$ ã«ã¤ã„ã¦ $i = 1$ ã¯æˆã‚Šç«‹ã¡ã€$1\leq i\leq k$ ã«ã¤ã„ã¦æˆã‚Šç«‹ã¤ã¨ã—ã¦ä»¥ä¸‹ã‚ˆã‚Šæ•°å­¦çš„å¸°ç´æ³•ã‹ã‚‰æˆã‚Šç«‹ã¤ã€‚

$$
\bm{b}_k = \bm{b}_k^* + \sum_{j=1}^{k-1} \mu_{kj}\bm{b}_j^* \in\langle\bm{b}_1^*,\ldots,\bm{b}_i^*\rangle_{\mathbb{R}}
$$

åŒæ§˜ã« $\langle\bm{b}_1,\ldots,\bm{b}_i\rangle_{\mathbb{R}}\supseteq\langle\bm{b}_1^*,\ldots,\bm{b}_i^*\rangle_{\mathbb{R}}$ ã‚‚æ•°å­¦çš„å¸°ç´æ³•ã‚ˆã‚Šæˆã‚Šç«‹ã¤ã€‚

$$
\bm{b}_k^* = \bm{b}_k - \sum_{j=1}^{k-1} \mu_{kj}\bm{b}_j^* \in\langle\bm{b}_1,\ldots,\bm{b}_i\rangle_{\mathbb{R}}
$$

ã‚ˆã£ã¦ $\langle\bm{b}_1^*,\ldots,\bm{b}_i^*\rangle_{\mathbb{R}}=\langle\bm{b}_1,\ldots,\bm{b}_i\rangle_{\mathbb{R}}$ ã¨ãªã‚‹ã€‚

4 ã«ã¤ã„ã¦ã¯ $\bm{B}=\bm{U}\bm{B}^*$ ã¨ $\det(\bm{U}) = 1$ã€GSO ãƒ™ã‚¯ãƒˆãƒ«ã®ç›´äº¤æ€§ã‚ˆã‚Š

$$
\begin{aligned}
\mathrm{vol}(\mathcal{L})^2 &= \det(\bm{B}\bm{B}^\top) \\
& = \det(\bm{U}\bm{B}^*(\bm{B}^*)^\top \bm{U}^\top) \\
& = \det(\bm{B}^*(\bm{B}^*)^\top) \\
& = \prod_{i=1}^n\|\bm{b}_i^*\|^2
\end{aligned}
$$

$\Box$

> **Def. å°„å½±æ ¼å­**
> $n$ æ¬¡å…ƒæ ¼å­ $L\subseteq\mathbb{R}^m$ ã®åŸºåº• $\lbrace\bm{b}_1,\ldots, \bm{b}_n\rbrace$ ã«å¯¾ã—, å„ $1\leq l\leq n$ ã«å¯¾ã—ã¦ $\langle\bm{b}_1,\ldots, \bm{b}_{l-1}\rangle_\mathbb{R}$ ã®ç›´äº¤è£œç©ºé–“ã¸ã®ç›´äº¤å°„å½±ã‚’ $\pi_l:\mathbb{R}^m\to\langle\bm{b}_1,\ldots, \bm{b}_{l-1}\rangle_\mathbb{R}^\bot$ ã¨ã™ã‚‹ã€‚ å®šç† 2 ã® 1,3 ã‚ˆã‚Š
>
> $$
\begin{aligned}
\langle\bm{b}_1, \ldots, \bm{b}_{l-1}\rangle_\mathbb{R}^\bot &= \langle\bm{b}_1^*, \ldots, \bm{b}_{l-1}^* \rangle_\mathbb{R}^\bot = \langle\bm{b}_l^*, \ldots, \bm{b}_n^* \rangle_\mathbb{R} \\
\pi_l(\bm{b}_i) &= \sum_{j=l}^i \mu_{i,j}\bm{b}_j^* \\
\end{aligned}
$$
>
> ã¨ãªã‚‹ã€‚ ã™ã‚‹ã¨é›†åˆ $\pi_l(L)$ ã¯ $\lbrace\pi_l(\bm{b}_l), \ldots, \pi_l(\bm{b}_n)\rbrace$ ã‚’åŸºåº•ã«æŒã¤ $n-l+1$ æ¬¡å…ƒã®æ ¼å­ã§ã‚ã‚Š, $\pi_l(L)$ ã‚’å°„å½±æ ¼å­ (projected lattice) ã¨å‘¼ã¶ã€‚

### ã‚µã‚¤ã‚ºåŸºåº•ç°¡ç´„

> **ã‚µã‚¤ã‚ºåŸºåº•ç°¡ç´„**
> $n$ æ¬¡å…ƒæ ¼å­ $L$ ã®åŸºåº• $\\{\bm{b_1},\ldots,\bm{b_n}\\}$ ã‚’ GSO ä¿‚æ•° $\mu_{i,j}$ ãŒ
>
> $$
|\mu_{i,j}| \leq \frac{1}{2} \quad (1 \leq \forall j < \forall i \leq n)
$$
>
> ã‚’æº€ãŸã™ã¨ãã€åŸºåº• $\\{\bm{b_1},\ldots,\bm{b_n}\\}$ ã¯ã‚µã‚¤ã‚ºç°¡ç´„ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†ã€‚
> GSO ãƒ™ã‚¯ãƒˆãƒ«ã‚’ç°¡ç´„ -> åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã‚’ç°¡ç´„
> 1. $q = \lfloor\mu_{ij}\rceil$ ã¨ã—ã¦ $\bm{b}_i\leftarrow\bm{b}_i - q\bm{b}_j$ ã¨æ›´æ–°ã™ã‚‹ã€‚
> 2. GSO ä¿‚æ•°ã«ã¤ã„ã¦ $\mu_{il}\leftarrow \mu_{il} - q\mu_{jl}$ ã¨æ›´æ–°ã™ã‚‹ã€‚

```python
def size_reduction(B):
    n = B.nrows()
    _, mu = B.gram_schmidt()
    for i in range(n):
        for j in range(i - 1, -1, -1):
            if mu[i][j].abs() > 1 / 2:
                q = mu[i][j].round()
                B[i] -= q * B[j]
                mu[i] -= q * mu[j]
    return B

B = matrix([[5, -3, -7], [2, -7, -7], [3, -10, 0]])
print(size_reduction(B))
```

$$
\begin{pmatrix}
5 & -3 & -7 \\
2 & -7 & -7 \\
3 & -10 & 0
\end{pmatrix}\to
\begin{pmatrix}
 5 & -3 & -7 \\
-3 & -4 & 0 \\
 1 & -3 & 7
\end{pmatrix}
$$

### LLL åŸºåº•ç°¡ç´„

$n$ æ¬¡å…ƒæ ¼å­ $L$ ã®åŸºåº• $\lbrace\mathbf{b_1},\ldots,\mathbf{b_n}\rbrace$ ã«ã¤ã„ã¦ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ã¨ãã€ãã®åŸºåº•ã¯ LLL ç°¡ç´„ã•ã‚Œã¦ã„ã‚‹ (Lenstra-Lenstra-Lovasz(LLL)-reduced)ã¨å‘¼ã¶ã€‚

1. åŸºåº• $\lbrace\mathbf{b_1},\ldots,\mathbf{b_n}\rbrace$ ãŒã‚µã‚¤ã‚ºç°¡ç´„ã•ã‚Œã¦ã„ã‚‹ã€‚
2. Lovaszæ¡ä»¶: ä»»æ„ã® $2 \leq k \leq n$ ã«å¯¾ã—ã¦ $\delta\|\mathbf{b}_{k-1}^*\| \leq \|\pi_{k-1}(\mathbf{b}_{k-1})\|$ ã‚’æº€ãŸã™ã€‚ãŸã ã—ã€å„ $1 \leq l \leq n$ ã«å¯¾ã—ã¦ã€$\pi_l$ ã¯ $\mathbb{R}$-ãƒ™ã‚¯ãƒˆãƒ«ç©ºé–“ $\langle\mathbf{b} _1,\ldots,\mathbf{b} _{l-1}\rangle _\mathbb{R}$ ã®ç›´äº¤è£œç©ºé–“ã¸ã®ç›´äº¤å°„å½±ã¨ã™ã‚‹ã€‚

ã“ã‚Œã«å¯¾ã—ã€LLL åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯æ¬¡ã®ã‚ˆã†ã«è¡Œã†ã€‚

1. ã‚µã‚¤ã‚ºç°¡ç´„ã™ã‚‹ã€‚
2. Lovaszæ¡ä»¶ã‚’æº€ãŸã™ã‚ˆã†ã«éš£ã‚Šåˆã†åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã‚’äº¤æ›ã™ã‚‹ã€‚

åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã‚’äº¤æ›ã—ãŸéš›ã« GSO ãƒ™ã‚¯ãƒˆãƒ«ã‚‚æ›´æ–°ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚é«˜é€ŸåŒ–å‡ºæ¥ã‚‹ã€‚

ã•ã‚‰ã« LLL ã«ã¤ã„ã¦ç²¾åº¦ã‚’ä¸Šã’ãŸã‚Šã€æ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ãŒã§ãã€DeepLLLã‚„MLLLãªã©ã®æ‰‹æ³•ãŒã‚ã‚‹ã€‚

- LLL ã¯éš£ã‚Šåˆã†åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã®ã¿ã‚’æ¯”è¼ƒã™ã‚‹ãŒã€DeepLLL ã¯å…¨ã¦ã®åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€‚
- MLLL ã¯ä¸€æ¬¡å¾“å±ãªãƒ™ã‚¯ãƒˆãƒ«ã§ã‚‚é©ç”¨ã§ãã‚‹ã€‚

> **LLL (Lenstra-Lenstra-Lovasz) åŸºåº•ç°¡ç´„**
> Lovasz æ¡ä»¶ã‚’ $1/4 < \delta < 1$ ã¨ã—ãŸã¨ãã«ä»»æ„ã® $2\leq k\leq n$ ã«å¯¾ã—ã¦æ¬¡ã‚’æº€ãŸã™ã“ã¨ã¨ã™ã‚‹ã€‚
>
> $$
\delta \|\bm{b}_{k-1}^*\|^2 \leq \|\pi_{k-1}(\bm{b}_k)\|^2
$$
>
> ã“ã®ã¨ãæ¬¡ã® 2 ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡Œãˆã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™ã€‚
> 1. ã‚µã‚¤ã‚ºåŸºåº•ç°¡ç´„
> 2. Lovasz æ¡ä»¶ã«åˆã†ã‚ˆã†ã«åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã®äº¤æ›

Nguyen and Stehle' ã®ç ”ç©¶ãªã©ã«ã‚ˆã‚Šç°¡ç´„ã•ã‚ŒãŸåŸºåº•ã®é•·ã•ã®ä¸Šé™ã¯ã“ã‚Œãã‚‰ã„ã¨è¦‹ç©ã‚‚ã‚‰ã‚Œã‚‹ã‚‰ã—ã„ã§ã™ã€‚

$$
\|\bm{b}_i\|\leq\sqrt{i}(1.02)^n\det(L)^{1/n}
$$


```python
def LLL(B, delta=0.99):
    assert 1 / 4 < delta < 1
    n = B.nrows()
    b = [0 for _ in range(n)]
    BB, mu = B.gram_schmidt()

    i = 1
    while i < n:
        # size reduction
        for j in range(i - 1, -1, -1):
            if mu[i][j].abs() > 1 / 2:
                q = mu[i][j].round()
                B[i] -= q * B[j]
                mu[i] -= q * mu[j]

        b[i - 1] = BB[i - 1].dot_product(BB[i - 1])
        b[i] = BB[i].dot_product(BB[i])

        # Lovasz condition
        if b[i] >= (delta - mu[i][i - 1] * mu[i][i - 1]) * b[i - 1]:
            i += 1
        else:
            B.swap_rows(i - 1, i)
            BB, mu = B.gram_schmidt()
            i = max(i - 1, 1)
    return B

def LLL(B, delta):
    n = len(B)
    assert 1 / 4 < delta < 1
    B = matrix(B)
    i = 1
    G, mu = B.gram_schmidt()
    while i < n:
        for j in range(i - 1, -1, -1):
            print(i, j)
            if mu[i][j].abs() > 1 / 2:
                q = mu[i][j].round()
                B[i] -= q * B[j]
                mu[i] -= q * mu[j]
        if B[i].norm() >= (delta - mu[i][i - 1] ^ 2) * B[i - 1].norm():
            i += 1
        else:
            B[i - 1], B[i] = B[i], B[i - 1]
            mu = GSOUpdate(B, mu, i)
            i = max(i - 1, 1)
    return B


def GSOUpdate(B, mu, i):
    n = B.nrows()
    nu = mu[i][i - 1]
    b = B[i] + nu ^ 2 * B[i - 1]
    print(nu, B[i - 1], b)
    mu[i][i - 1] = nu * B[i - 1] / b
    B[i] = B[i] * B[i - 1] / b
    B[i - 1] = b
    for j in range(i - 1):
        mu[i - 1][j], mu[i][j] = mu[i][j], mu[i - 1][j]
    for k in range(i + 1, n):
        t = mu[k][i]
        mu[k][i] = mu[k][i - 1] - nu * t
        mu[k][i - 1] = t + mu[i][i - 1] * mu[k][i]
    return mu

B = [vector([5, -3, -7]), vector([2, -7, -7]), vector([3, -10, 0])]
print(LLL(B, 0.8))
```

### ã‚ˆã‚Šå¼·ã„åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
CTF ã§ã¯ LLL ã§ååˆ†ç°¡ç´„åŒ–ã§ãã¾ã™ãŒ CVP ã‚’è§£ãéš›ã«å¼·ã„ã¨å–ã‚Œã‚‹ã¨ããŒã‚ã‚‹ã®ã§çŸ¥è­˜ã¨ã—ã¦ BKZ ã‚’çŸ¥ã£ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

> **HKZ (Hermite-Korkine-Zolotareff) åŸºåº•ç°¡ç´„**
> 1. ã‚µã‚¤ã‚ºåŸºåº•ç°¡ç´„
> 2. ã™ã¹ã¦ã® $1\leq i\leq n$ ã«å¯¾ã—ã¦ $\|\bm{b}_i^*\| = \lambda_1(\pi_i(L))$ ã‚’æº€ãŸã™ã‚ˆã†ã«åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã®äº¤æ›

> **BKZ (Block Korkine-Zolotareff) åŸºåº•ç°¡ç´„**
> 1. ã‚µã‚¤ã‚ºåŸºåº•ç°¡ç´„
> 2. ã™ã¹ã¦ã® $1\leq k\leq n-\beta+1$ ã«å¯¾ã—ã¦ $\beta$ æ¬¡å…ƒã®æ ¼å­ $L_{[k,k+\beta-1]} = \lbrace\pi_k(\bm{b}_k), \pi_k(\bm{b}_{k+1}), \ldots, \pi_k(\bm{b}_{k+\beta-1})\rbrace$ ã®åŸºåº•ã‚’ HKZ åŸºåº•ç°¡ç´„

## åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å¿œç”¨

### å¤šå¤‰æ•°ä¸å®šä¸€æ¬¡æ–¹ç¨‹å¼ã®è§£
å¤šå¤‰æ•°ä¸å®šä¸€æ¬¡æ–¹ç¨‹å¼ã¨è¨€ã‚ã‚Œã¦ã‚‚ãƒ‘ãƒƒã¨åˆ†ã‹ã‚‰ãªã„ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚“ãªæ„Ÿã˜ã®æ–¹ç¨‹å¼ã®ã“ã¨ã§ã™ã€‚

$$
a_1x_1 + a_2x_2 + \cdots + a_nx_n + b = 0
$$

ä¾‹ãˆã° 2 å¤‰æ•°ã®ã¨ãæ–¹ç¨‹å¼ã¯ $a_1x + a_2y = b$ ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯é«˜æ ¡ã§ä¸€æ¬¡ä¸å®šæ–¹ç¨‹å¼ã¨ã—ã¦ç¿’ã£ãŸã¨æ€ã„ã¾ã™ã€‚ãã“ã§ã¯ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’åŠ©æ³•ã‚’ç”¨ã„ã¦ä»£è¡¨è§£ $(x, y) = (x_0, y_0)$ ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã§ä¸€èˆ¬è§£ã¯ $(x, y) = (a_2m + x_0, -a_1m + y_0)$ ($m$ ã¯æ•´æ•°) ã¨è§£ã‘ã¾ã—ãŸã€‚

ã—ã‹ã— 3 å¤‰æ•°ä»¥ä¸Šã ã¨ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’å¿œç”¨ã™ã‚‹ã®ãŒé›£ã—ãä»£è¡¨è§£ã¯æ±‚ã¾ã‚Šã¾ã›ã‚“ã€‚ã•ã¦ã“ã“ã§åŸºåº•ç°¡ç´„ã®å‡ºç•ªã§ã™ã€‚åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã¯ãƒ™ã‚¯ãƒˆãƒ«ã®è¶³ã—å¼•ãã‚’ã™ã‚‹ã“ã¨ã§å°ã•ãªãƒ™ã‚¯ãƒˆãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã—ãŸã€‚ã“ã‚Œã‚’æ–¹ç¨‹å¼ã®è¶³ã—å¼•ãã«å¿œç”¨ã—ã¦æ ¼å­å•é¡Œã«å¸°ç€ã•ã›ã¦è§£ãã¾ã™ã€‚

ã¾ãšæ–¹ç¨‹å¼ $a_1x_1 + \cdots + a_nx_n = 0$ ã¯æ¬¡ã®æ ¼å­

$$
\begin{pmatrix}
  1 &&& a_1 \\
  & \ddots && \vdots \\
  && 1 & a_n \\
\end{pmatrix}
$$

ã‚’ç”¨æ„ã—ã¦åŸºåº•ç°¡ç´„ã—ãŸã¨ãã«æœ€å¾ŒãŒã‚¼ãƒ­ã¨ãªã‚‹è¡Œ

$$
\begin{pmatrix}
x_1 & \cdots & x_n & 0
\end{pmatrix}
$$

ã‚’è¦‹ã¤ã‘ãŸã‚‰ä»£è¡¨è§£ãŒæ±‚ã¾ã‚Šã¾ã™ï¼ã“ã‚Œã¯å„è¡Œã‚’è¶³ã—å¼•ãã—ã¦ä¿‚æ•°ã®åˆ—ã‚’æœ€å°åŒ–ã•ã›ã‚‹ã®ã§ä»•çµ„ã¿ã¨ã—ã¦ã¯å‡ºæ¥ãã†ã§ã™ã€‚ãƒã‚¸ãƒƒã‚¯ã¿ãŸã„ã§ã™ãŒã“ã‚Œã§æœ¬å½“ã«è§£ã‘ã¦ã—ã¾ã„ã¾ã™ã€‚

æ›´ã«å®šæ•°é …ã‚’åŠ ãˆãŸæ–¹ç¨‹å¼ $a_1x_1 + \cdots + a_nx_n + b = 0$ ã«ã¤ã„ã¦ã¯ $B = x_1\cdots x_n$ ã¨ãŠã„ã¦æ ¼å­

$$
\begin{pmatrix}
  O(B/x_1) &&&& a_1 \\
  & \ddots &&& \vdots \\
  && O(B/x_n) && a_n \\
  &&& O(B) & b \\
\end{pmatrix}
$$

ã‚’åŸºåº•ç°¡ç´„ã—ã¦æœ€å¾ŒãŒã‚¼ãƒ­ã¨ãªã‚‹è¡ŒãŒè¦‹ã¤ã‹ã‚Œã°ä»£è¡¨è§£ãŒåˆ†ã‹ã‚Šã¾ã™ï¼

$$
\begin{pmatrix}
x_1O(B/x_1) & \cdots & x_nO(B/x_n) & O(B) & 0
\end{pmatrix}
$$

ãŸã ã— $O(\cdot)$ ã¯ä¸­ã®å€¤ã®å¤§ä½“ã®æ¨å®šå€¤ã‚’å…¥ã‚Œã‚‹ã¨ã—ã¾ã™ã€‚CTF ã§ã¯ãƒ“ãƒƒãƒˆæ•°ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ 2 ã®ç´¯ä¹—ã‚’é©åˆ‡ã«ä»£å…¥ã—ã¾ã™ã€‚ã“ã†ã™ã‚‹ã“ã¨ã§å®šæ•°éƒ¨åˆ†ãŒ 1 ä»¥å¤–ã®å€¤ã‚’å–ã‚‰ãªã„ã‚ˆã†ã«è¡Œã‚’æœ€å°åŒ–ã—ã¦ãã‚Œã¾ã™ã€‚

ã¾ãŸå‰°ä½™ã®æ–¹ç¨‹å¼ $a_1x_1 + \cdots + a_nx_n + b = 0 \pmod N$ ã«ã¤ã„ã¦ã¯

$$
\begin{pmatrix}
  O(B/x_1) &&&& a_1 \\
  & \ddots &&& \vdots \\
  && O(B/x_n) && a_n \\
  &&& O(B) & b \\
  &&&& N \\
\end{pmatrix}
$$

ã‚’åŸºåº•ç°¡ç´„ã—ã¦æœ€å¾ŒãŒã‚¼ãƒ­ã¨ãªã‚‹è¡Œã‚’è¦‹ã¤ã‘ã‚Œã°ã„ã„ã§ã™ã€‚

$$
\begin{pmatrix}
x_1O(B/x_1) & \cdots & x_nO(B/x_n) & O(B) & 0
\end{pmatrix}
$$

ã‚³ã‚¹ãƒˆãªã—ã§ä½•åº¦ã§ã‚‚ $N$ ã‚’å¼•ã„ã¦æœ€å°åŒ–ã™ã‚‹ã®ã§å‰°ä½™ã¨åŒã˜æ„å‘³ã¨ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å¤šå¤‰æ•°ä¸å®šä¸€æ¬¡æ–¹ç¨‹å¼ã‚’è§£ãã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ CTF ã§é »å‡ºãªæŠ€è¡“ã§ã™ã€‚æ¬¡ã®è‰¯è¨˜äº‹ã§ç·´ç¿’ã™ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚

https://qiita.com/kusano_k/items/5509bff6e426e5043591

### ãƒŠãƒƒãƒ—ã‚µãƒƒã‚¯æš—å· (Markle-Hellman Knapsack encryption)
ä¸€èˆ¬ã®æ•°åˆ— $b_i$ ã«å¯¾ã—ã¦ $c = \sum_i m_ib_i$ ã¨ãªã‚‹ $c$ ã‹ã‚‰ $m_i$ ã‚’æ±‚ã‚ã‚‹ã®ã¯é›£ã—ã„ãŒ $b_i$ ãŒè¶…å¢—åŠ åˆ—ã¨ã„ã†æ€§è³ªã‚’æŒã¤ã¨ãç°¡å˜ã«ãªã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ãŸæš—å·ã§ã™ã€‚

> **Def. è¶…å¢—åŠ åˆ—**
> æ¬¡ã®æ€§è³ªã‚’æº€ãŸã™æ•°åˆ— $\lbrace w_i\rbrace$ ã‚’è¶…å¢—åŠ åˆ—ã¨å‘¼ã¶ã€‚
>
> $$
\sum_{i=1}^n w_i < w_{n+1}
$$

> **ãƒŠãƒƒãƒ—ã‚µãƒƒã‚¯æš—å· (Markle-Hellman Knapsack encryption)**
> - éµç”Ÿæˆ
>   1. è¶…å¢—åŠ åˆ— $\lbrace w_i\rbrace$ ã‚’ç”Ÿæˆã™ã‚‹ã€‚
>   2. æ•´æ•° $q, r$ ã«ã¤ã„ã¦ $q > \sum_i w_i$, $\gcd(r, q) = 1$ ãªã‚‹ã‚ˆã†ã«ç”Ÿæˆã™ã‚‹ã€‚
>   3. $b_i = rw_i \pmod q$ ã‚’è¨ˆç®—ã—ã€$\lbrace b_i\rbrace, q$ ã‚’å…¬é–‹éµã€$\lbrace w_i\rbrace, r$ ã‚’ç§˜å¯†éµã¨ã™ã‚‹ã€‚
> - æš—å·åŒ–
>   å¹³æ–‡ $m_i\in\lbrace 0, 1\rbrace$ ã‚’ç”¨ã„ã¦æ¬¡ã®ã‚ˆã†ã«æš—å·æ–‡ $c$ ã‚’å¾—ã‚‹ã€‚
>
>   $$
c = \sum_i m_ib_i \pmod q
$$
> - å¾©å·
>   1. æš—å·æ–‡ $c$ ã«å¯¾ã—ã¦ç§˜å¯†éµ $r$ ã‚’ç”¨ã„ã¦ $c' = cr^{-1} \bmod q = \sum_i m_iw_i$ ã‚’è¨ˆç®—ã™ã‚‹ã€‚
>   2. $i$ ã‚’é™é †ã«æ¬¡ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
>
>   $$
\begin{aligned}
m_i & \leftarrow \begin{cases}
0 & (c' \leq w_i) \\
1 & (c' > w_i)
\end{cases} \\
c' & \leftarrow c' - w_i
\end{aligned}
$$

ã“ã‚ŒãŒä½å¯†åº¦ã®ã¨ã LLL ã‚’ç”¨ã„ã¦æ”»æ’ƒã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚LO æ³• (Lagarias-Odlyzko Algorithm) ã¨ CLOS æ³• (Coster LaMacchia Odlyzko Schnorr) ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚

LO æ³•ã¯æ¬¡ã®è¡Œåˆ—ã‚’ LLL ç°¡ç´„ã—ã¦å·¦ç«¯ãŒ $0$, ãã‚Œä»¥å¤–ãŒ $0, 1$ ã®ã¿ã§ã‚ã‚‹è¡ŒãŒã‚ã‚Œã°ã€ãã‚Œã¯å¾©å·çµæœã®å€™è£œã¨ãªã‚Šã¾ã™ã€‚

$$
\begin{pmatrix}
\bm{b} & I \\
-c & \bm{0}
\end{pmatrix} =
\begin{pmatrix}
b_1 & 1 &&& \\
b_2 && 1 && \\
\vdots &&& \ddots & \\
b_n &&&& 1 \\
-c &&&& \\
\end{pmatrix}
$$

CLOS æ³•ã¯åŸºåº•è¡Œåˆ—ã‚’ã¡ã‚‡ã£ã¨å¤‰æ›´ã—ã¦ç²¾åº¦ã‚’å‘ä¸Šã•ã›ãŸæ–¹æ³•ã§ã™ã€‚ã¾ãš $0, 1$ ã¯ãƒãƒ«ãƒ ã«éå¯¾ç§°æ€§ãŒã‚ã‚‹ã®ã§ $-1, 1$ ã«å¤‰æ›´ã—ã€å·¦ç«¯ã‚’å„ªå…ˆçš„ã« $0$ ã«ã™ã‚‹ã‚ˆã†ä¼ãˆã‚‹ç‚ºé©å½“ãªå¤§ããªå®šæ•° $K$ ã‚’æ›ã‘ã¾ã™ã€‚

$$
\begin{pmatrix}
K\bm{b} & 2I \\
-Kc & -\bm{1}
\end{pmatrix} =
\begin{pmatrix}
Kb_1 & 2 &&& \\
Kb_2 && 2 && \\
\vdots &&& \ddots & \\
Kb_n &&&& 2 \\
-Kc & -1 & -1 & \cdots & -1 \\
\end{pmatrix}
$$

### Approximate Common Divisor Problem

æ•°åˆ—ã«å¯¾ã—ã¦èª¤å·®ã‚’å«ã‚€å¤§æ ã®å…¬ç´„æ•°ã‚’æ±‚ã‚ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚
æ•°åˆ— $\lbrace x_i\rbrace$ ãŒ $x_i = q_ip + r_i$ ã‹ã¤ $p \gg r_i$ ã¨ã„ã†é–¢ä¿‚ãŒã‚ã‚‹ã¨ãæ¬¡ã®ã‚ˆã†ãªæ ¼å­ã‚’çµ„ã‚€ã“ã¨ã§ $q_0$ ãŒã‚ã‹ã‚Šã¾ã™ã€‚

$$
\begin{pmatrix}
K & x_1 & x_2 & \cdots & x_n \\
& -x_0 &&& \\
&& -x_0 && \\
&&& \ddots & \\
&&&& -x_0  \\
\end{pmatrix}
$$
$$
\begin{aligned}
\bm{v} & = \begin{pmatrix}
q_0K & q_0x_1 - q_1x_0 & \cdots & q_0x_n - q_nx_0
\end{pmatrix} \\
& = \begin{pmatrix}
q_0K & q_0r_1 - q_1r_0 & \cdots & q_0r_n - q_nr_0
\end{pmatrix} \\
\end{aligned}
$$

ã“ã® $q_0$ ã‚’ç”¨ã„ã¦ $r_0 = x_0 \pmod{q_0}$ ã§ $r_0$ ã‚’æ±‚ã‚ã€$p = (x_0 - r_0) / q_0$ ã¨ã™ã‚‹ã“ã¨ã§å…¬ç´„æ•°ã‚’ç™ºè¦‹ã§ãã‚‹ã€‚

[Algorithms for the Approximate Common Divisor Problem](https://eprint.iacr.org/2016/215.pdf)

### Coppersmith's Method
å…ˆã»ã©å¤šå¤‰æ•°ä¸å®šä¸€æ¬¡æ–¹ç¨‹å¼ã‚’è€ƒãˆã¾ã—ãŸãŒæ¬¡ã«å‰°ä½™ä¸Šã® $n$ æ¬¡æ–¹ç¨‹å¼ã®è§£ã‚’æ ¼å­å•é¡Œã«å¸°ç€ã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¾ã™ã€‚

$$
a_nx^n + \cdots + a_1x + a_0 = 0 \pmod N
$$

ã¾ãšè€ƒãˆã‚‹ã®ã¯ãã‚Œãã‚Œã®æ¬¡æ•°ã«ã¤ã„ã¦ $x_i = x^i$ ã¨ãã‚Œãã‚Œå¤‰æ•°ã§ç½®ã„ã¦è€ƒãˆã¦åŸºåº•ç°¡ç´„ã™ã‚‹æ–¹æ³•ã§ã™ã€‚ç²¾åº¦ã¯è½ã¡ã¾ã™ãŒ $n = 2, 3$ ç¨‹åº¦ã¾ã§ã¯æœ‰åŠ¹ã§ã™ã€‚

$$
\begin{pmatrix}
  O(x^n) &&&& a_0 \\
  & \ddots &&& \vdots \\
  && O(x) && a_{n-1} \\
  &&& O(1) & a_n \\
  &&&& N \\
\end{pmatrix}
$$

ã“ã‚Œã‚’æ”¹è‰¯ã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¾ã™ã€‚ã¾ãšå‰°ä½™ã®æ–¹ç¨‹å¼ã¯ä¿‚æ•°ãŒã‚ã‚‹ç¨‹åº¦å°ã•ã‘ã‚Œã°ãã®ã¾ã¾æ•´æ•°ä¿‚æ•°æ–¹ç¨‹å¼ã¨ãªã‚‹ã‚ˆã¨ã„ã†ä¸»å¼µã‚’ã™ã‚‹ Howgrave-Graham ã®è£œé¡Œã‚’ç¤ºã—ã¾ã™ã€‚

> **Lemma. Howgrave-Graham ã®è£œé¡Œ**
> æ•´æ•°ä¿‚æ•°å¤šé …å¼ $g(x) = g_0 + g_1x + g_2x^2 + \cdots + g_{d-1} x^{d-1}$ ã«ã¤ã„ã¦ $N$ ã‚’æ³•ã¨ã—ãŸã¨ã $|x_0| \leq X$ ã‚’æº€ãŸã™è§£ $g(x_0) = 0 \pmod{N}$ ãŒæ•´æ•°ä¿‚æ•°å¤šé …å¼ã®è§£ $g(x_0) = 0$ ã¨ãªã‚‹ååˆ†æ¡ä»¶ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚
>
> $$
\|g(xX)\| = \sqrt{g_0^2 + (g_1X)^2 + (g_2X^2)^2 + \cdots + (g_{d-1}X^{d-1})^2} < \frac{N}{\sqrt{d}}
$$


**Proof.**

$$
\begin{aligned}
|g(x_0)| &= \left|\sum_{i=0}^{d-1}g_ix_0^i\right| \\
&\leq \sum_{i=0}^{d-1}|g_ix_0^i| \\
&\leq \sum_{i=0}^{d-1}|g_i|X^i \\
&\leq \sqrt{\sum_{i=0}^{d-1}1} \sqrt{\sum_{i=0}^{d-1}(|g_i|X^i)^2} && \left(\because \text{Cauchyâ€“Schwarz ã®ä¸ç­‰å¼}\right) \\
&= \sqrt{d}\|g(xX)\| < N && \left(\because \|g(xX)\| < \frac{N}{\sqrt{d}}\right)
\end{aligned}
$$

$g(x_0) = 0 \pmod N$ ã‚ˆã‚Š $g(x_0) = 0$ ã¨ãªã‚‹ã€‚
$\Box$

å‰°ä½™ã®æ–¹ç¨‹å¼ã‚’åŸºåº•ç°¡ç´„ã—ã¦ä¿‚æ•°ã‚’å°ã•ãã™ã‚Œã°æ•´æ•°æ–¹ç¨‹å¼ã«å¤‰æ›ã§ãã¦è§£ã‘ã‚‹ã®ã§ã¯...ï¼ï¼Ÿã¨æ°—ä»˜ãã§ã—ã‚‡ã†ã€‚ãŸã åŸºåº•ç°¡ç´„ã™ã‚‹ç‚ºã«ã¯åŒã˜è§£ã‚’æŒã¤è¤‡æ•°ã®æ–¹ç¨‹å¼ãŒå¿…è¦ã§ã™ãŒä»Šã¯ 1 ã¤ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«å¯¾ã—ã¦ã¯å‰°ä½™ã‚’ $\bmod{N^m}$ ã«æŒã¡ä¸Šã’ã‚‹ã“ã¨ã§è¤‡æ•°ã®åŒã˜è§£ã®æ–¹ç¨‹å¼ã‚’ä½œã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

> **Lemma. Hensel ã®æŒã¡ä¸Šã’**
> å¤šé …å¼ $f(x)$ ã®è§£ $f(x_0) = 0 \pmod N$ ã«å¯¾ã—ã¦å¤šé …å¼ $g_{i,j}(x)$ ãŒ $g_{i,j}(x_0) = 0 \pmod{N^m}$ ã‚’æº€ãŸã™ã«ã¯æ¬¡ã®ã‚ˆã†ã«ãŠã‘ã°ã‚ˆã„ã€‚
>
> $$
g_{i,j}(x) := N^{mâˆ’i}x^j f^i(x) \qquad (0 \leq i \leq m, 0 \leq j\leq l)
$$
>
> ãŸã ã— $m, l$ ã¯æ•´æ•°ã¨ã™ã‚‹ã€‚

**Proof.**
$f(x_0) = 0 \pmod N$ ãªã®ã§ $f(x_0) = kN$ ã¨ãŠã‘ã‚‹ã€‚

$$
\begin{aligned}
g_{i,j}(x_0) &= N^{mâˆ’i}x_0^j f^i(x_0) \\
&= N^{mâˆ’i}x_0^j (kN)^i \\
&= k^ix_0^j N^m
\end{aligned}
$$

ã‚ˆã‚Š $g_{i,j}(x_0) = 0 \pmod{N^m}$ ã¨ãªã‚‹ã€‚
$\Box$

å°ã•ãã—ãŸã„æ–¹ç¨‹å¼ã¯ $g_{i,j}(xX)$ ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦æ¬¡ã®æ ¼å­ã‚’åŸºåº•ç°¡ç´„ã—ã¾ã™ã€‚

$$
\begin{pmatrix}
g_{0,0}^{(0)} & g_{0,0}^{(1)}X & g_{0,0}^{(2)}X^2 & \cdots & g_{0,0}^{(n)}X^n \\
&& \vdots \\
g_{0,l}^{(0)} & g_{0,l}^{(1)}X & g_{0,l}^{(2)}X^2 & \cdots & g_{0,l}^{(n)}X^n \\ \\
g_{1,0}^{(0)} & g_{1,0}^{(1)}X & g_{1,0}^{(2)}X^2 & \cdots & g_{1,0}^{(n)}X^n \\
&& \vdots \\
g_{1,l}^{(0)} & g_{1,l}^{(1)}X & g_{1,l}^{(2)}X^2 & \cdots & g_{1,l}^{(n)}X^n \\ \\
&& \vdots \\
g_{m,l}^{(0)} & g_{m,l}^{(1)}X & g_{m,l}^{(2)}X^2 & \cdots & g_{m,l}^{(n)}X^n \\
\end{pmatrix}
$$

ãŸã ã— $g_{i,j}(x)$ ã® $k$ æ¬¡ã®ä¿‚æ•°ã®ã“ã¨ã‚’ $g_{i,j}^{(k)}$ ã¨è¡¨ã—ã¾ã—ãŸã€‚

ã“ã‚Œã‚’åŸºåº•ç°¡ç´„ã—ã¦å‡ºã¦ããŸæ–¹ç¨‹å¼ãŒ Howgrave-Graham ã®è£œé¡Œã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚Œã°æ•´æ•°ä¿‚æ•°æ–¹ç¨‹å¼ã¨ãªã£ã¦ Berlekamp-Zassenhause æ³•ãªã©ã‚’ç”¨ã„ã¦è§£ã‘ã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’ã¾ã¨ã‚ã¦ Coppersmith Method ã¨å‘¼ã³ã¾ã™ã€‚

> **Thm. Coppersmith's Theorem**
> $f(x)$ ã‚’ $N$ ã‚’æ³•ã¨ã™ã‚‹ãƒ¢ãƒ‹ãƒƒã‚¯ãª $d$ æ¬¡å¤šé …å¼ã«ã¤ã„ã¦æ¬¡ã®æ¡ä»¶ã‚’æº€ãŸã™ã¨ãè§£ $x_0$ ($|x_0| < X$) ã‚’åŠ¹ç‡ã‚ˆãæ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
>
> $$
\|f(xX)\| < \frac{N}{\sqrt{d}}
$$

æ¡ä»¶å¼ãŒè¦šãˆã«ãã„ã®ã§å¤§ä½“ $x_0 < \sqrt[d]{N}$ ã®è§£ã‚’æ¢ç´¢ã—ã¦ãã‚Œã‚‹ã¨æ€ãˆã°ã„ã„ã§ã™ã€‚

ã•ã‚‰ã« Coppersmith Method ã«ã¯æ‹¡å¼µã§ãã‚‹ã“ã¨ãŒ 2 ã¤ã‚ã‚Šã¾ã™ã€‚

- æœªçŸ¥ã®æ³•ã«ã¤ã„ã¦è§£ã‘ã‚‹
  - æ—¢çŸ¥ã®æ³•ã®ç´„æ•°ã‚’æ³•ã¨ã™ã‚‹å¼ã®è§£ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚ç´„æ•°ã®æ³•ãŒå°ã•ã„ã»ã©æ–¹ç¨‹å¼ã«å¯¾ã™ã‚‹åˆ¶ç´„ãŒã‚†ã‚‹ããªã‚Šã¾ã™ã€‚
- å¤šå¤‰æ•°ã®æ–¹ç¨‹å¼ã‚‚è§£ã‘ã‚‹
  - å¤‰æ•°ã®æ•°ãŒå¤šã„ã»ã©æ–¹ç¨‹å¼ã«å¯¾ã™ã‚‹åˆ¶ç´„ãŒã‚­ãƒ„ããªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã¯ Howgrave-Graham ã®è£œé¡Œ ãªã©ã‚’è¦‹ç›´ã™ã“ã¨ã§ç°¡å˜ã«æ‹¡å¼µã§ãã¾ã™ã€‚è©³ç´°ã¯å‚è€ƒæ–‡çŒ®ã¨ã‹ã«ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ç†è«–ã¨ã—ã¦ã¯ã–ã£ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ãŒ SageMath ã‚’ä½¿ãˆã°ä½•ã‚‚åˆ†ã‹ã‚‰ãªãã¨ã‚‚é›°å›²æ°—ã§ä½¿ãˆã¾ã™ã€‚

https://doc.sagemath.org/html/en/reference/polynomial_rings/sage/rings/polynomial/polynomial_modn_dense_ntl.html#sage.rings.polynomial.polynomial_modn_dense_ntl.small_roots

## æ ¼å­æš—å·

è€é‡å­æš—å·ã®ä¸­ã§ã¯æ ¼å­æš—å·ãŒæœ€ã‚‚æœ‰åŠ›ã§ã™ã€‚ãŸã è€é‡å­æ€§ã‚’ç¤ºã™ã®ã¯é›£ã—ã„ã‚‰ã—ãã€ãã‚Œã‚’ç¤ºã›ã‚‹ã‚ˆã†ãªæš—å·ãŒé¸è€ƒã§é€šã‚ŠãŒã¡ã‚‰ã—ã„ã§ã™ã€‚ã¾ãŸæ ¼å­ã®è¨ˆç®—å›°é›£ãªå•é¡Œã«ã¯ã•ã¾ã–ã¾ãªç¨®é¡ãŒã‚ã‚Šã€ãã‚Œã«å¿œã˜ã¦ã•ã¾ã–ã¾ãªæ ¼å­æš—å·ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯è€é‡å­æš—å·ã‚„å®Œå…¨æº–åŒå‹æš—å·ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ LWE å•é¡Œã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

```mermaid
flowchart LR
    id0(SVP) --> id1(CVP) --> id(LWE)
```

### æœ€è¿‘ãƒ™ã‚¯ãƒˆãƒ«å•é¡Œ (CVP)
LWE å•é¡Œã‚’è§£ãç‚ºã«ã¯ã¾ãš CVP ãŒè§£ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚SVP ã¯åŸç‚¹ã«æœ€ã‚‚è¿‘ã„æ ¼å­ç‚¹ã‚’æ±‚ã‚ã‚‹å•é¡Œã§ã—ãŸãŒ CVP ã¯ã‚ã‚‹ç‚¹ã«æœ€ã‚‚è¿‘ã„æ ¼å­ç‚¹ã‚’æ±‚ã‚ã‚‹å•é¡Œã§ã™ã€‚

> **CVP; Closest Vector Problem**
> CVP ã¨ã¯ç›®æ¨™ãƒ™ã‚¯ãƒˆãƒ« $\bm{w}$ (æ ¼å­ç‚¹ã§ã‚ã‚‹å¿…è¦ã¯ãªã„) ã«å¯¾ã—ã¦æ ¼å­ä¸Šã®æœ€è¿‘ãƒ™ã‚¯ãƒˆãƒ« $\bm{v}$ ã‚’æ±‚ã‚ã‚‹å•é¡Œã§ã‚ã‚‹ã€‚

å³å¯†è§£ã‚’æ±‚ã‚ã‚‹ã®ã¯é›£ã—ã„ã®ã§è¿‘ä¼¼è§£ã‚’æ±‚ã‚ã¾ã™ã€‚ã“ã®è¿‘ä¼¼è§£ã‚’è§£ãä»£è¡¨çš„ãªæ–¹æ³•ã« Babaiâ€™s nearest plane algorithm ã¨ Kannan's embedding method ãŒã‚ã‚Šã¾ã™ã€‚

> **Babaiâ€™s nearest plane algorithm**
> $n$ æ¬¡å…ƒã®æ ¼å­ã«ã¤ã„ã¦ç›®æ¨™ãƒ™ã‚¯ãƒˆãƒ«ã«å¯¾ã—ã¦æœ€ã‚‚è¿‘ã„ $n-1$ æ¬¡å…ƒè¶…å¹³é¢ã‚’ $1$ ã¤é¸ã¶ã“ã¨ã‚’å¸°ç´çš„ã«ç¹°ã‚Šè¿”ã™ã“ã¨ã§ CVP ã‚’è§£ãã€‚

èª¬æ˜é€šã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```python
def babai_cvp(B, w):
    n = B.nrows()
    BB, _ = B.gram_schmidt()
    e = w
    for i in range(n)[::-1]:
        c = (e.dot_product(BB[i]) / BB[i].dot_product(BB[i])).round()
        e -= c * B[i]
    return w - e


B = matrix([[1, 2, 3], [3, 0, -3], [3, -7, 3]])
w = vector([10, 6, 5])
v = babai_cvp(B, w)
print(v)
```

> **Kannanâ€™s embedding method**
> CVP ã®ç›®æ¨™ãƒ™ã‚¯ãƒˆãƒ« $w$ ã¨è§£ãƒ™ã‚¯ãƒˆãƒ« $v$ ã®å·® $e = w - v$ ã®ãƒãƒ«ãƒ ã«ã¤ã„ã¦ $\|e\| < \lambda_1/2$ ãŒæˆã‚Šç«‹ã¤ã¨ã SVP ã‚’è§£ãã“ã¨ã§æ±‚ã¾ã‚‹ã€‚

ã“ã‚Œã¯æ ¼å­

$$
\begin{pmatrix}
  \bm{B} & \bm{0}^\top \\
  \bm{w} & M
\end{pmatrix}
=
\begin{pmatrix}
b_{11} & \cdots & b_{1m} & 0 \\
\vdots & \ddots & \vdots & \vdots \\
b_{n1} & \cdots & b_{nm} & 0 \\
w_1 & \cdots & w_m & M
\end{pmatrix}
$$

ã‚’åŸºåº•ç°¡ç´„ã—ã¦æœ€ã‚‚çŸ­ã„ãƒ™ã‚¯ãƒˆãƒ«ã®è¡ŒãŒè§£ã¨ãªã‚Šã¾ã™ã€‚

$$
\begin{pmatrix}
e_1 & \cdots & e_m & M
\end{pmatrix}
$$

ã“ã‚Œã¯ SVP ã‚ˆã‚ŠåŠåˆ†ä»¥ä¸ŠçŸ­ã„ CVP ã®è§£ãŒã‚ã‚‹ã‹ã‚‰æ±‚ã¾ã‚Šã¾ã™ã€‚

```python
def kannan_cvp(B, w):
    n = B.nrows()
    M = 1
    BB = block_matrix([[B, matrix(ZZ, n, 1)], [w, M]])
    BB = BB.LLL()
    e = matrix(BB[0][0:n])
    return w - e


B = matrix([[1, 2, 3], [3, 0, -3], [3, -7, 3]])
w = matrix([10, 6, 5])
v = kannan_cvp(B, w)
print(v)
```

### Learning With Error
LWE å•é¡Œã¯æ©Ÿæ¢°å­¦ç¿’ç†è«–ã‹ã‚‰æ´¾ç”Ÿã—ãŸæ±‚è§£å›°é›£ãªå•é¡Œã‚‰ã—ã„ã§ã™ã€‚LWE (Learning With Error) å•é¡Œã‚’ç”¨ã„ãŸæš—å·ã‚’ LWE æ ¼å­æš—å·ã¨ã„ã„ã¾ã™ã€‚

> **LWE å•é¡Œ**
> $K$ ã‚’ä½“ã¨ã™ã‚‹ã€‚$\bm{A}\in K^{m\times n}, \bm{s}\in K^m$ ã‚’æ›ã‘ã¦èª¤å·®ãƒ™ã‚¯ãƒˆãƒ« $\bm{e}\in K^n$ ã‚’ä¸ãˆãŸ $\bm{b}\in K^n$ ã«å¯¾ã— $(\bm{A}, \bm{b})$ ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã« $\bm{s}$ ã‚’æ±‚ã‚ã‚‹å•é¡Œã‚’ä¸€èˆ¬ã« LWE (Learning With Error) å•é¡Œã¨å‘¼ã¶ã€‚
>
> $$
\bm{A}\bm{s} + \bm{e} = \bm{b}
$$
>
> ç‰¹ã« $q$ ã‚’ç´ æ•°ã¨ã—ã¦ $K = \mathbb{F}_q$ ã®ã¨ã LWE å•é¡Œã€ $K = \mathbb{F}_q[x]/(x^n + 1)$ ã‹ã¤ $m = 1$ ã®ã¨ã Ring-LWE å•é¡Œã€ $K = \mathbb{F}_q[x]/(x^n + 1)$ ã®ã¨ã Module-LWE å•é¡Œã¨ã„ã„ã¾ã™ã€‚

ã“ã®èª¤å·®ãŒãªã‘ã‚Œã°é€†è¡Œåˆ—ã‚’æ›ã‘ã‚Œã°ã™ãã«æ±‚ã¾ã‚‹ã®ã§ã™ãŒã€èª¤å·®ãŒã‚ã‚‹ã“ã¨ã§é€”ç«¯ã«å•é¡ŒãŒé›£ã—ããªã‚Šã¾ã™ã€‚ã¾ãŸ $\bm{s}$ ã‚„ $\bm{e}$ ã¯ã‚¼ãƒ­ã‹ã‚‰é›¢ã‚Œéãã‚‹ã¨ä»–ã®è§£ã¨æ··ã–ã£ã¦ã—ã¾ã†ã®ã§æ¬¡ã®ã‚ˆã†ãªå½¢ã¨ãªã‚‹äºŒé …åˆ†å¸ƒã‚„ãã®æ¥µé™ã§ã‚ã‚‹æ­£è¦åˆ†å¸ƒãªã©ã®åˆ†å¸ƒã®ä¹±æ•°ãŒç”¨ã„ã‚‰ã‚Œã€$B \geq 2\sqrt{n}$ ã®ã¨ãè¨ˆç®—å›°é›£ãªå•é¡Œã§ã‚ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

è¿‘ä¼¼è§£ã¯åŸºåº•ç°¡ç´„ã—ã¦ CVP ã¨ã—ã¦è§£ãæ„Ÿã˜ã§ã™ã€‚

```python
def solve_LWE(A, b):
    m = A.nrows()
    n = A.ncols()
    q = A.base_ring().order()
    BB = block_matrix([[A.change_ring(ZZ).transpose()], [q * matrix.identity(m)]])
    BB = BB.LLL()[n:]
    v = babai_cvp(BB, b.change_ring(ZZ))
    s = v[:n] * A[:n].transpose() ^ -1
    return s


q = 29
A = matrix(
    GF(q),
    [
        [1, 5, 21, 3, 14],
        [17, 0, 12, 12, 13],
        [12, 21, 15, 6, 6],
        [4, 13, 24, 7, 16],
        [20, 9, 22, 27, 8],
        [19, 8, 19, 3, 1],
        [18, 22, 4, 8, 18],
        [6, 28, 9, 5, 18],
        [10, 11, 19, 18, 21],
        [28, 18, 24, 27, 20],
    ],
)
b = vector(GF(q), [28, 2, 24, 16, 11, 14, 7, 28, 27, 13])
s = solve_LWE(A, b)
print(s)
```

### CRYSTALS-KYBER
CRYSTALS-KYBER ã¨ã¯ NIST ãŒé¸è€ƒã—ã¦ã„ã‚‹è€é‡å­æš—å·ã®ä¸€ç¨®ã§ Module-LWE ã‚’ç”¨ã„ãŸæš—å·ã§ã™ã€‚

Module-LWE ã¯å¤šé …å¼ $\mathbb{F}_q[x]/(x^n + 1)$ ä¸Šã®æ¼”ç®—ã§ã—ãŸã€‚æ³¨æ„ã¨ã—ã¦ $x^n + 1$ ã¯ $\mathbb{F}_q[x]$ ã«ãŠã„ã¦æ—¢ç´„å¤šé …å¼ã§ã‚ã‚‹ã‹ã‚‰ $\mathbb{F}_q[x]/(x^n + 1)$ ã¯ä½“ã¨ãªã‚Šã¾ã™ã€‚ç°¡å˜ã®ç‚ºã€$R_q = \mathbb{F}_q[x]/(x^n+1)$, $R = \mathbb{Z}[x]/(x^n+1)$ ã¨æ›¸ãã“ã¨ã«ã—ã¾ã™ã€‚å¤šé …å¼åŒå£«ã®ç©ã¯æ•°è«–å¤‰æ› (NTT; Number Theoretic Transform) ã‚’ç”¨ã„ã¦é«˜é€Ÿã«è¨ˆç®—ã§ãã¾ã™ã€‚

> **Def. å¤šé …å¼ã®åœ§ç¸®**
> ã¾ãŸ $R_q$ ã§ã‚ã‚Œã°å„è¦ç´ ã«å¯¾ã—ã¦åœ§ç¸®ã‚’è¡Œã†ã€‚
> ã‚·ãƒ¼ãƒ‰å€¤ $\rho$ ã‹ã‚‰å¤šé …å¼ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•° $Sam(\rho)$ ã‚’ç”¨ã„ã‚‹ã€‚
>
> $$
\begin{aligned}
\mathrm{Compress}_q(x, d) & = \lceil(2^d/q)x\rfloor \bmod q \\
\mathrm{Decompress}_q(x, d) & = \lceil(q/2^d)x\rfloor
\end{aligned}
$$

> **Prop. åœ§ç¸®è§£å‡ã‚’ã—ã¦ã‚‚èª¤å·®ãŒå°ã•ã„**
> $d < \lceil\log_2(q)\rceil$ ã¨ã—ã¦ $\mathbb{F}_q\to\lbrace 0,\ldots,2^d-1\rbrace$ ã¨åœ§ç¸®ã—ã€æ¬¡ã®ã‚ˆã†ãªæ€§è³ªã‚’æº€ãŸã™ã€‚
>
> $$
\begin{aligned}
& x' = \mathrm{Decompress}_q(\mathrm{Compress}_q(x, d), d) \\
& |x' - x\bmod q|\leq\lceil q/2^{d+1}\rfloor
\end{aligned}
$$

ã“ã‚Œã‚ˆã‚Šåœ§ç¸®è§£å‡ã®èª¤å·®ã‚’ LWE ã®èª¤å·®ã«ä¹—ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

> **CRYSTALS-KYBER**
> - éµç”Ÿæˆ
>   1. ä¸€æ§˜åˆ†å¸ƒã§ $\bm{A}\in R_q^{k\times k}$ ã¨äºŒé …åˆ†å¸ƒã§ $\bm{s}, \bm{e}\in R^{k}$ ã‚’ç”Ÿæˆã—ã€$\bm{b} = \bm{A}\bm{s} + \bm{e}$ ã‚’è¨ˆç®—ã™ã‚‹ã€‚
>   2. $(\bm{b}, \bm{A})$ ã‚’åœ§ç¸®ã—ãŸã‚‚ã®ã‚’å…¬é–‹éµã€$\bm{s}$ ã‚’ç§˜å¯†éµã¨ã™ã‚‹ã€‚
> - æš—å·åŒ–
>   1. äºŒé …åˆ†å¸ƒã§ $\bm{r}, \bm{e}_1\in R^k, e_2\in R$ ã‚’ç”Ÿæˆã™ã‚‹ã€‚
>   2. $\bm{b}$ ã‚’è§£å‡ã—ã¦å¹³æ–‡ $m$ ã‚’ç”¨ã„ã¦ $(\bm{u}, v) = (\bm{A}^T\bm{r} + \bm{e}_1, \bm{b}^T\bm{r} + e_2 + \lceil\frac{q}{2}\rfloor \cdot m)$ ã‚’åœ§ç¸®ã—ãŸã‚‚ã®ã‚’æš—å·æ–‡ã¨ã—ã¦è¿”ã™ã€‚
> - å¾©å·
>   æš—å·æ–‡ $(\bm{u}, v)$ ã‚’è§£å‡ã—ã¦ $\mathrm{Compress}_q(v - \bm{s}^T\bm{u}, 1)$ã€ã¤ã¾ã‚Š $q / 2$ ã«è¿‘ã„å€¤ã¯ $1$ ã€$0$ ã«è¿‘ã„å€¤ã¯ $0$ ã¨ã—ã¦è¿”ã™ã€‚

```python
from Crypto.Util.number import bytes_to_long
from Crypto.Random.random import randint, getrandbits

def num2bins(x):
    y = []
    while x != 0:
        y.append(x & 1)
        x >>= 1
    return y

def bins2num(x):
    y = 0
    for i in range(len(x)):
        y += x[i] * (1 << i)
    return y

class CrystalsKyber:
    def binomial_poly(self):
        res = []
        for i in range(self.N):
            tmp = 0
            for i in range(self.eta):
                a = getrandbits(1)
                b = getrandbits(1)
                tmp += a - b
            res.append(tmp)
        return self.Rq(res)

    def random_poly(self):
        return self.Rq([randint(int(0), int(self.q)) for _ in range(self.N)])

    def __init__(self, q, k, eta, N):
        K = GF(q)
        PR.<X> = PolynomialRing(GF(q))
        Rq.<x> = PR.quotient(X^N + 1)
        self.Rq = Rq
        self.q = q
        self.k = k
        self.eta = eta
        self.N = N

        A = matrix([[self.random_poly() for _ in range(k)] for _ in range(k)])
        s = vector([self.binomial_poly() for _ in range(k)])
        e = vector([self.binomial_poly() for _ in range(k)])
        b = A * s + e

        self.pub = (b, A)
        self.priv = s

    def encrypt(self, m):
        Rq.<x> = self.Rq
        (b, A) = self.pub

        m = Rq(num2bins(m))
        r = vector([self.binomial_poly() for _ in range(self.k)])
        e1 = vector([self.binomial_poly() for _ in range(self.k)])
        e2 = self.binomial_poly()

        u = A.transpose() * r + e1
        v = b * r + e2 + (q / 2).round() * m
        return (u, v)

    def decrypt(self, c):
        s = self.priv

        u, v = c
        m = v - s * u
        ms = []
        # 1 if the coeff is close to q / 2
        for coeff in m.lift().coefficients(sparse=False):
            coeff = QQ(coeff) * 2 / q
            coeff = coeff.round() % 2
            ms.append(coeff)
        return bins2num(ms)

q, k, eta, N = 7681, 3, 4, 256
enc = CrystalsKyber(q, k, eta, N)
m = 11
assert m < 2^N
c = enc.encrypt(m)
_m = enc.decrypt(c)
assert m == _m
```

TODO: ã©ã®ãã‚‰ã„ã®æƒ…å ±ãŒã‚ã‚Œã°ç ´ã‚Œã‚‹ã®ã‹ã‚’å…·ä½“çš„ã«è©±ã—ãŸã„
https://eprint.iacr.org/2023/777.pdf

## ã¾ã¨ã‚
æ ¼å­ã®åŸºåº•ç°¡ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯æ ¼å­æš—å·ã ã‘ã§ã¯ãªãæ§˜ã€…ãªæš—å·ã®æ”»æ’ƒã«å¿œç”¨ã§ãã€CTF ã§ã¯éå¸¸ã«é‡è¦ãªãƒ„ãƒ¼ãƒ«ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚ŒãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Œã° Crypto ä¸Šç´šè€…ã®ä»²é–“å…¥ã‚Šãªã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ã€‚

## å‚è€ƒæ–‡çŒ®
- https://www.cryptrec.go.jp/exreport/cryptrec-ex-2404-2014.pdf
- https://joint.imi.kyushu-u.ac.jp/wp-content/uploads/2022/08/220801_03hiromasa.pdf
- [å…ƒè«–æ–‡](https://static.aminer.org/pdf/PDF/000/192/854/finding_a_small_root_of_a_univariate_modular_equation.pdf)
- [katagaitai workshop 2018 winter](http://elliptic-shiho.github.io/slide/katagaitai_winter_2018.pdf)