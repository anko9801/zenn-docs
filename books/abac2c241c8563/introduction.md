---
title: "Introduction"
---

これは東京工業大学デジタル創作同好会 traP の講習会資料です。

## 話すこと
21B の可愛い子担当あんこです。
サマーウォーズ観たことありますか！？

CTF で Crypto が解けるようになるだけではなく最新の暗号研究に追い付く為に必要な知識も解説していきたいと思います。

Crypto は CTF 特有の発想力よりかは数学色、パズル色が強いです。

私もすべて理解している訳ではないので知っていることだけを紹介します。



アニメと同じく12話構成です。実質アニメなんじゃないでしょうか？

それではどうぞアニメライフをごゆっくりとお楽しみください。

### 対象読者
対象者によって読む所が違うように工夫したので長いなと感じたらこれを参考にするといいかもしれません。
- 暗号自体を軽く調べたい方
  - Introduction と暗号プロトコルについて読むと幸せになれます。
- Crypto を解けるようになりたい方
  - Introduction、RSA暗号への攻撃、楕円曲線暗号への攻撃を読むと幸せになれます。
- 数学が好きな方
  - 暗号技術を支える計算機代数から準同型暗号までを読むと幸せになれます。
- 暗号に強い興味がある方
  - 全部読もう！

### 前提知識
- (必須) 線形代数の基礎的な知識
- (必須) Python の基礎的な構文
- (あるとよい) 群環体などの代数学
- (より理解したい方向け) 代数幾何学や楕円曲線論

### 目標
- CTF の Crypto で難しい問題が解けるようになる
- 最新の暗号研究を追うことができるようになる

暗号の専門家ではないし、情報の専門家ですらないので不適切な表現があればご指摘いただけると幸いです。

## 暗号とは

暗号というのは悪いことをさせない機構です。

通信時に悪いことが出来ないとは具体的に何でしょうか？

- 機密性 (Confidentiality)
平文に関するあらゆる情報を得られない
- 完全性 (Integrity)
改ざんされない
- 真正性 (Authenticity)
なりすまされない

逆に「解読、改ざん、なりすまし」が出来なければ、悪いことが出来ないということが証明されます。(要出典) exploit はどうなん

### 解読されないとは
暗号というのは元来「**暗号化は簡単でも復号は難しい**」という非対称性があります。

例えば換え字暗号は「文字置換は簡単でもどう置換したのかを調べるのは難しい」という非対称性、 RSA 暗号であれば「掛け算は簡単でも素因数分解は難しい」という非対称性、AES であれば「シャッフルは簡単でも元に戻すのは難しい」という非対称性があります。

TODO:

**共通鍵暗号**
暗号化と復号で **同じ鍵** を使い、暗号化で使う鍵を **秘密** にする方式
ex.) AES, DES, ChaCha20 など

共通鍵暗号は比較的高速に処理できる反面、最初に共通鍵を相手に渡さないといけず、それを攻撃者に盗聴される危険があって、それだけだと安全に通信できません。そこで公開鍵暗号です。

**公開鍵暗号**
暗号化と復号で **別の鍵** を使い、暗号化で使う鍵を **公開** する方式
ex.) RSA暗号, 楕円曲線暗号 など

公開鍵暗号は暗号化と復号で別の鍵を用いるので、暗号鍵を公開しても攻撃者は復号することができません。その為、共通鍵を渡すときや秘密を安全に通信したいときに重宝します。

この 2 つの暗号を使い分けて安全な通信路を構築することができます。

このようにして機密性のある通信ができます。

### なりすまされないとは
信頼できない相手に対してどのように正当性を担保するのかという問題はインターネットが普及した現代では非常によくあります。

皆さんがよく使う **パスワード認証** はなりすましを防ぐ手段の 1 つです。
合言葉であるパスワードを知っている人しかログインできないようにすれば、ユーザーの正当性は大体担保できます。ただしこれはユーザーにとって分かりやすいシステムな反面、パスワードが使い回されていたり、簡潔なものに設定されているなどしていると、アカウントが乗っ取られてしまうことがあります。ですのでちゃんとサービス毎にそれぞれ違う複雑なパスワードを覚えて設定する...なんてことは僕には無理でブラウザが生成した乱数値か FIDO を使うのがいいでしょう。

パスワード認証の他に **電子署名** というのもあります。
まず信頼された第三者機関である認証局 (CA) が公開鍵暗号の秘密鍵と公開鍵のペアを生成し、公開鍵を公開します。そして CA は秘密鍵を用いて電子証明書を発行し、ユーザーに渡します。ここで公開鍵を用いて証明書を検証することができるので、証明書を持っているユーザーなら認証することができます。
TODO: 画像

SSH の公開鍵認証ってしたことありますか？公開鍵を `authorized_keys` に書いて `ssh` コマンド叩いて `fingerprint` がなんとかかんとかとか言われたりして接続できるやつです。あれは CA が接続するユーザーと同一人物のときのデジタル署名で、ユーザー自身で署名を発行してホストに検証してもらうという認証をしています。
TODO: 画像

最近この手の話題はよく話されているので、知ってる単語と結びつけて理解してみましょう。詳しくは traP とかいうサークルが解説記事いっぱい出してるんじゃないですかね。

- MFA; Multi-Factor Authentication / 2FA
パスワードに加えて、デバイス認証やEメール、生体認証など、他の認証方法も用いた認証。
- OAuth 2.0 / OpenID Connect / SAML
他サービスへの認可と認証を行う規格。「Google でサインインする」や「Twitter と連携する」というのを見たことありますか？あれが認証認可です。
- WebAuthn / FIDO
公開鍵認証をブラウザ上で行う規格。公開鍵認証に移行してパスワードをこの世から消滅させる目的。Yubico など。
- マイナンバーカード
電子証明書を搭載した IC チップ付き身分証。身分証に目が行きがちだが電子署名で確実な本人確認が可能なことが良いところ。

このように真正性は保証されます。

### 改ざんされないとは
まず先に断っておくのですが、本質的に改ざんさせないということは **不可能** です。
通信を覗いて暗号文を適当に書き換えたものを送りつければ、平文も書き換わりますからね。何故かというと暗号は復号可能性により暗号文と平文は一対一に対応しているので、平文が変われば暗号文も変わるし、逆も同様です。

それでは改ざんされることは許すとして、改ざんされたことを検知できれば良いですよね。検知する手法としてはいくつかありますが、最も基本的な方法はハッシュ関数という関数を使う方法です。

ハッシュ関数というのは一方向にしか計算できない関数、つまりあるデータのハッシュ値から元のデータが取り出せられないような関数です。具体的には SHA-3, SHA-1, MD5 などがあります。これを使って以下のようなことをします。
TODO: 本当に一方向であることは大切なのか？

1. 暗号化された通信上であるデータとそのハッシュ値を送る
2. 送られてきたデータのハッシュ値と送られてきたハッシュ値が一致するかどうか検査する

![](/images/hash2.png)

こうすることでデータが書き換わると送られてきたハッシュ値とは異なるハッシュ値となり、改ざんを検知できるという訳です。

他にも検知する方法はありますが基本的にハッシュ関数をベースに作られています。

- MAC; Message Authentication Code
暗号学的に強い一方向性の関数を用いたメッセージ改ざん検知する関数。HMAC, AES-CMAC など。
- AEAD; Authenticated Encryption with Associated Data
暗号化とメッセージ改ざん検知を同時に行う暗号方式。AES-GCM, ChaCha20-Poly1308 など。

このように完全性が保証されます。

## あそんでみよう
実際の CTF ではよくわからない暗号やエンコーディング、古典暗号が出題されることがあるのですが、大抵ググるか CyberChef に投げれば解けてしまいます。

https://gchq.github.io/CyberChef/

換え字式暗号なら quipquip も使います。

https://quipqiup.com/

:::message
**練習問題**
CyberChef で遊んでみよう
- RSA 暗号
- Base64
- 署名
- 鍵共有
- エニグマ
:::

## まとめ
はい、初回終わりです。類を見ないくらいの速さで暗号の全体図を解説しましたが、、、ついてこれましたか！？

これを聞いて次は中身がどうなっているのか気になりませんか？攻撃したくなりませんか？

## 参考文献
- https://letsencrypt.org/docs/challenge-types/

