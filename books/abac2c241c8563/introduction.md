---
title: "Introduction"
---

## 話すこと
CTF で Crypto が解けるようになるだけではなく最新の暗号研究に追い付く為に必要な知識も解説していきたいと思います。

Crypto は CTF 特有の発想力よりかは数学色、パズル色が強いです。

私もすべて理解している訳ではないので知っていることだけを紹介します。

アニメと同じく12話構成です。実質アニメなんじゃないでしょうか？

それではどうぞアニメライフをごゆっくりとお楽しみください。

### 対象読者
対象者によって読む所が違うように工夫したので長いなと感じたらこれを参考にするといいかもしれません。
- 暗号自体を軽く調べたい方
  - Introduction と暗号プロトコルについて読むと幸せになれます。
- Crypto を解けるようになりたい方
  - Introduction、RSA暗号への攻撃、楕円曲線暗号への攻撃を読むと幸せになれます。
- 数学が好きな方
  - 暗号技術を支える計算機代数から準同型暗号までを読むと幸せになれます。
- 暗号に強い興味がある方
  - 全部読もう！

### 前提知識
- (必須) 線形代数の基礎的な知識
- (必須) Python の基礎的な構文
- (あるとよい) 群環体などの代数学
- (より理解したい方向け) 代数幾何学や楕円曲線論

### 目標
- CTF の Crypto で難しい問題が解けるようになる
- 最新の暗号研究を追うことができるようになる

暗号の専門家ではないし、情報の専門家ですらないので不適切な表現があればご指摘いただけると幸いです。

## 暗号の歴史

> 1974年, カリフォルニア大学バークレー校の計算機科学の学部学生で 22 歳になったばかりのマークル (Merkle) は, 指導教官の理解のない状態で孤立しながらも, 1つの画期的なアイデアにど到達した. それは、盗聴されてもいい通信路を使って2人の参加者が安全に秘密情報を共有する方法についてのアイデアであった。
> この問題は、インターネットの原型である米国国防省のプロジェクトアーパネット(ARPANET) が 1969 年に始まったことに触発されたものでありゅ。アーパネットは米国全土の様々な大学にあるコンピュータを通信回線で結んでコンピュータネットワークを構築するプロジェクトであった。ここでの基本方針はプロトコルだけを決めておき、あとは自主的に大学間でネットワークを構築する草の根ネットワークである。ネットワーク全体を管理する機能はなく、通信のセキュリティやプライバシーを守る機能もない。アーパネットは、1969 年に米国西海岸の 2 つの大学 (UCLA とスタンフォード大学) の間で最初のネットワークが構築され、1970 年代にはカリフォルニア大学バークレー校など西海岸の大学から全米の大学へと広がっていった。
> 1970 年代初頭にアーパネットプロジェクトを知り、マークルが気づいた問題はセキュリティ機能がないネットワークを使った安全な通信は可能であるかということであった。いま、事前に何ら共有情報を保持していない 2 人の利用者 A と B が安全でないネットワークで結ばれているとしよう。このネットワーク上で $A$ と $B$ が通信を行い、
1969年 ARPANET

共通鍵暗号
暗号化と復号で **同じ鍵** を使い、暗号化で使う鍵を **秘密** にする方式
ex.) DES, AES, ChaCha20

- DES
  - 最初に標準化された共通鍵暗号
- Triple-DES
  - DES の脆弱性を受けて改良したもの
- AES
  - 現代の共通鍵暗号の標準

公開鍵暗号
暗号化と復号で **別の鍵** を使い、暗号化で使う鍵を **公開** する方式
ex.) RSA暗号, Rabin暗号

- RSA暗号
- 楕円曲線暗号

DH鍵共有
公開鍵暗号を用いて共通鍵暗号を渡すプロトコル

TLS/SSL
HTTPS や SMTPS などで使用されている暗号プロトコル

1995年 SSL 3.0 が公開
- Netscape Communications 社が開発
1999年 TLS 1.0 の制定
- 国際標準化の為に SSL から名称変更
- 既に SSL という名称が定着していた為、SSL という名前も残る
SSL は TLS の前身で現在は使用されていない。

## 暗号とは

暗号というのは悪いことをさせない機構です。

通信時に悪いことが出来ないとは具体的に何でしょうか？

- 機密性 (Confidentiality)
平文に関するあらゆる情報を得られない
- 完全性 (Integrity)
改ざんされない
- 真正性 (Authenticity)
なりすまされない

逆に「解読、改ざん、なりすまし」が出来なければ、悪いことが出来ないということが証明されます。(要出典) exploit はどうなん

### 解読されないとは
暗号というのは元来、秘密鍵を持っていないと「**暗号化は簡単でも復号は難しい**」という非対称性があるということが言えます。

例えば換え字暗号は「文字変換は簡単でも総当りするのは難しい」という非対称性、 RSA 暗号であれば「掛け算は簡単でも素因数分解は難しい」という非対称性、AES であれば「シャッフルは簡単でも元に戻すのは難しい」という非対称性があります。

### 改ざんされないとは
まず先に断っておくのですが、本質的に改ざんさせないということは不可能です。
通信を覗いて暗号文を適当に書き換えたものを送りつければ、平文も書き換わりますからね。何故かというと暗号は復号可能性により暗号文と平文は一対一に対応しているので、平文が変われば暗号文も変わるし、逆も同様です。

それでは改ざんされることは許すとして、改ざんされたことを検知できれば良いですよね。検知する手法としてはいくつかありますが、最も基本的な方法はハッシュ関数という関数を使う方法です。

ハッシュ関数とは

1. あるデータとそのハッシュ値の署名を送る
2. 送られてきたデータのハッシュ値と送られてきた署名の平文が同じなら「改ざんされていない」、そうでなければ「改ざんされている」と判定する

こうすることでデータが書き換われば検知されるし、署名が書き換われば検知される。更に整合性を保つように両方書き換えることについては署名である為に秘密鍵が必要なので改ざんは難しい。ということで改ざんを検知できます。

他にも検知する方法はありますが基本的にハッシュ関数をベースに作られています。これらは後で解説します。

- MAC; Message Authentication Code
- AEAD; Authenticated Encryption with Associated Data

### なりすまされないとは
信頼できない相手をどのように正当性を担保するのかというのは現代でよくあります。

皆さんがよく使う **パスワード認証** はなりすましを防ぐ手段の 1 つです。
合言葉であるパスワードを知っている人しかログインできないようにすれば、ユーザーの正当性は大体担保できます。これはユーザーにとって分かりやすいシステムな反面、パスワードが使い回されていたり、簡潔なものに設定されているなどしていると、アカウントが乗っ取られてしまうことがあります。ですのでちゃんとそれぞれ違う複雑なパスワードを設定する...なんてことは僕には無理で FIDO かブラウザが生成した乱数値を使うのがいいでしょう。

パスワード認証の他に **デジタル署名** というのもあります。
簡単に言えば合言葉という概念を公開鍵暗号を使って実現する方法です。まず信頼された第三者機関である認証局 (CA) は秘密鍵を用いて署名された証明書を発行します。その証明書は対応する公開鍵によって検証できるので、証明書を持っているユーザーを認証することができます。

まぁそこまで複雑に考えなくても「秘密鍵で署名して、公開鍵で検証する」ってことを覚えておけば色々通用します。

SSH の公開鍵認証ってしたことありますか？公開鍵を `authorized_keys` に書いて `ssh` コマンド叩いて `fingerprint` がなんとかかんとかとか言われたりして接続できるやつです。あれは CA が接続するユーザーと同一人物のときのデジタル署名で、ユーザー自身で署名を発行してホストに検証してもらうという認証をしています。
TODO: 画像

最近その手の話題はよくあって詳しい解説は他の記事に任せます。traP とかいうサークルが解説記事いっぱい出してるんじゃないですかね。

- MFA; Multi-Factor Authentication / 2FA
- OAuth2.0 / OpenID Connect
- WebAuthn / FIDO

なりすましを中間者攻撃 (Man in the middle) とも言います。

マイナンバーカードの ID 連携することで統計情報を取れる

## あそんでみよう
実際の CTF ではよくわからない暗号やエンコーディング、古典暗号が出題されることがあるのですが、大抵 CyberChef に投げれば解けてしまいます。

https://gchq.github.io/CyberChef/

https://quipqiup.com/

:::message
**練習問題**
CyberChef で遊んでみよう
- RSA 暗号
- Base64
- 署名
- 鍵共有
- エニグマ
:::

## 参考文献
- https://letsencrypt.org/docs/challenge-types/