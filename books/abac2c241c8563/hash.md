---
title: "ハッシュとブロックチェーン"
---

## ハッシュ関数
信頼できないソースの正当性を証明するものというのは世界中で必要とされています。

> **ハッシュ関数**
>

CRC

> **暗号学的ハッシュ関数**
>

- MD5
- [SHA; Secure Hash Algorithm](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf)
  - 現代で最も使われている

暗号ではパスワードの保存や HMAC, 署名などに使われていたりします。ただ暗号で使うためには攻撃者がハッシュ値に対する元の入力に関する情報を得られないようにしないといけません。これを原像計算困難性といいます。

![](/images/hash.png)

これを満たしたハッシュというのは実際にあります。MD5 や SHA1, SHA-256 などなど、まぁそれぞれのハッシュの実装は結構荒っぽく作られてるので詳細は省きます。ただし攻撃するときの重要な性質として Merkle-Damgård construction というものがあるのでそれだけ知っておきましょう。

### Merkle-Damgård construction
ハッシュ関数は任意長のメッセージを固定長の出力に変換しないといけません。その為に入力を固定長のブロックに分割し、1つずつ内部状態に適用させます。
![](/images/length_extension.png)

MD5 や SHA-1 などよく使われるハッシュ関数はこれです。このときに成立する攻撃というのが伸長攻撃です。伸長攻撃には慎重につってね！フゥーワッ！

## ハッシュの応用
まず SHA-256 などの暗号学的ハッシュ関数を使う一番の例としては改ざん検知です。SHA-256 をそのまま貼り付けるのと HMAC

HMAC はハッシュを用いるメッセージ認証コード (Message Authentication Codes; MAC) で改ざん検知を行います。

> **HMAC; Hash-based MAC**
> 秘密鍵 $K$ とハッシュ値長 $B$ として次のように定義します。
>
> $$
\begin{aligned}
pad_{in} & := \overbrace{\mathrm{0x36}\|\cdots\|\mathrm{0x36}}^B \\
pad_{out} & := \overbrace{\mathrm{0x5C}\|\cdots\|\mathrm{0x5C}}^B \\
\mathrm{HMAC}(K, V) & := H(K \oplus pad_{out} \| H(K \oplus pad_{in} \| V))
\end{aligned}
$$

CRC とはビット列を有限体を用いて短いビット列に変換するハッシュ関数です。CRC はデータ転送時の誤り検出に用いられています。ただ CRC は暗号学的ハッシュ関数ではないので改ざんには弱いです。

> **巡回冗長検査 (CRC; Cyclic Redundancy Check)**
> 次数 $n$ の生成多項式 $f(x)\in\mathbb{F}_2[x]$ を用いて表される有限体 $\mathbb{F}_{2^n} \cong \mathbb{F}_2[x]/(f(x))$ において関数 $g: \mathbb{F}_2[x]/(f(x))\ni m \mapsto mx^n\in\mathbb{F}_2[x]/(f(x))$ を CRC の定義とする。

例えば生成多項式が $f(x) = x^4 + x + 1$ (CRC-4-ITU) のときのハッシュ化において入力が $1011000_{(2)}$ なら次の計算から出力は $1111_{(2)}$ となります。

$$
\begin{aligned}
m & = x^6 + x^4 + x^3 \\
mx^n & = (x^6 + x^4 + x^3)x^4 \\
& = x^{10} + x^8 + x^7 \\
& = x^3 + x^2 + x + 1 \pmod{x^4 + x + 1}
\end{aligned}
$$

実際に使われる CRC-32 では次の生成多項式を用います。

$$
x^{32} + x^{26} + x^{23} + x^{22} + x^{16} + x^{12} + x^{11} + x^{10} + x^8 + x^7 + x^5 + x^4 + x^2 + x + 1
$$

実装では多項式を反転させてビット演算に落とし込むことで高速化できます。

> **ブロックチェーン**

## ハッシュへの攻撃
原像計算が攻撃

### データベース
大量の種類の平文とそのハッシュ値をデータベースに入れてハッシュ値から平文を出力するようなシステムを構成でき、それを逆ハッシュと言います。

### 伸長攻撃 (Length Extension Attack)
$H(m_1)$ から $H(m_1\|m_2)$ を求める

### 誕生日攻撃 (Birthday Attack)
誕生日のパラドックスを用いた攻撃です。

> **Def. ハッシュ値の衝突**
> $H(m_1) = H(m_2)$ となる異なる $m_1, m_2$ が発見された状態

この衝突を恣意的に起こせるとハッシュ値で改ざんを検知してるシステムを騙すことが出来てしまいます。これは誕生日攻撃を用いて恣意的に起こすことができます。

誕生日攻撃というのはハッシュ値のビット数を $n$ として平文 $m$ とそのハッシュ値 $H(m)$ の対応を $O(2^{n/2})$ 程度集めるとハッシュが同じとなるような $m$ が $50\%$ の確率で見つかるという誕生日のパラドックスによる攻撃です。

### Differenctial Cryptoanalysis
暗号を解析しながら SMT を用いて解く


ランダムオラクルモデル
スタンダードモデル

## まとめ
また[準同型のハッシュ関数](https://github.com/benwr/bromberg_sl2)などもあり、発展も期待です。

## 参考文献
- [Length Extension Attackの原理と実装](https://ptr-yudai.hatenablog.com/entry/2018/08/28/205129)
- https://vividot-de.fi/entry/beanstalk-exploit

この資料は CC0 ライセンスです。