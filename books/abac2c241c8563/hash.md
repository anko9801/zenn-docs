---
title: "ハッシュとブロックチェーン"
---

## ハッシュ関数
信頼できないソースの正当性を証明するものというのは世界中で必要とされています。
ハッシュ関数とは

- MD5
- SHA
  - 現代で最も使われている

暗号ではパスワードの保存や HMAC, 署名などに使われていたりします。ただ暗号で使うためには攻撃者がハッシュ値に対する元の入力に関する情報を得られないようにしないといけません。これを原像計算困難性といいます。

![](/images/hash.png)

これを満たしたハッシュというのは実際にあります。MD5 や SHA1, SHA-256 などなど、まぁそれぞれのハッシュの実装は結構荒っぽく作られてるので詳細は省きます。ただし攻撃するときの重要な性質として Merkle-Damgård construction というものがあるのでそれだけ知っておきましょう。

### Merkle-Damgård construction
ハッシュ関数は任意長のメッセージを固定長の出力に変換しないといけません。その為に入力を固定長のブロックに分割し、1つずつ内部状態に適用させます。
![](/images/length_extension.png)

MD5 や SHA-1 などよく使われるハッシュ関数はこれです。このときに成立する攻撃というのが伸長攻撃です。伸長攻撃には慎重につってね！フゥーワッ！

## ハッシュの応用
### HMAC (Hash-based MAC)
これを秘密鍵を用いて検査するコードのことをメッセージ認証コード (message authentication codes; MAC) と言います。その中でハッシュを用いる MAC を HMAC と呼びます。

秘密鍵 $K$ とハッシュ値長 $B$ として HMAC の値 $C$ を次のように定義します。

$$
\begin{aligned}
pad_{in} & := \overbrace{\mathrm{0x36}\|\cdots\|\mathrm{0x36}}^B \\
pad_{out} & := \overbrace{\mathrm{0x5C}\|\cdots\|\mathrm{0x5C}}^B \\
\mathrm{HMAC}(K, V) & := H(K \oplus pad_{out} \| H(K \oplus pad_{in} \| V))
\end{aligned}
$$

### CRC
ビット列を $\mathbb{F}_2[x]/(f(x))$ に変換して誤り検出する方法です。$f(x)$ を生成多項式と呼び、CRC-32 では次の生成多項式を用います。

$$
x^{32} + x^{26} + x^{23} + x^{22} + x^{16} + x^{12} + x^{11} + x^{10} + x^8 + x^7 + x^5 + x^4 + x^2 + x + 1
$$

具体的には2進数の入力を多項式に変換した $m\in\mathbb{F}_2[x]$、生成多項式の次数を $n$ とすると $mx^n$ を $\mathbb{F}_2[x]/(f(x))$ として解釈したものが出力となります。

例えば入力が $1011000_{(2)}$ で生成多項式が $f(x) = x^4 + x + 1$ の場合

$$
\begin{aligned}
m & = x^6 + x^4 + x^3 \\
mx^n & = (x^6 + x^4 + x^3)x^4 = x^{10} + x^8 + x^7 + x^5 = x^3 + x^2 + x + 1 \pmod{f(x)}
\end{aligned}
$$

より出力は $1111_{(2)}$ となります。

実装では多項式を反転させてビット演算に落とし込むことで高速化できます。

### ブロックチェーン

## 攻撃
### データベース
逆ハッシュ化はデータベースを用いている

### 伸長攻撃 (Length Extension Attack)
$H(m_1)$ $H(m_1\|m_2)$ を求める

### 誕生日攻撃 (Birthday Attack)
誕生日のパラドックスを用いた攻撃です。

> **Def. ハッシュ値の衝突**
> $H(m_1) = H(m_2)$ となる異なる $m_1, m_2$ が発見された状態

この衝突を恣意的に起こせるとハッシュ値で改ざんを検知してるシステムを騙すことが出来てしまいます。これは誕生日攻撃を用いて恣意的に起こすことができます。

誕生日攻撃というのはハッシュ値のビット数を $n$ として平文 $m$ とそのハッシュ値 $H(m)$ の対応を $O(2^{n/2})$ 程度集めるとハッシュが同じとなるような $m$ が $50\%$ の確率で見つかるという誕生日のパラドックスによる攻撃です。

### Differenctial Cryptoanalysis
暗号を解析しながら SMT を用いて解く



## まとめ
また[準同型のハッシュ関数](https://github.com/benwr/bromberg_sl2)などもあり、発展も期待です。

## 参考文献
- [Length Extension Attackの原理と実装](https://ptr-yudai.hatenablog.com/entry/2018/08/28/205129)
- https://vividot-de.fi/entry/beanstalk-exploit

この資料は CC0 ライセンスです。